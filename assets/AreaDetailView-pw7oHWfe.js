import{u as de,r as $,c as h,a as re,w as ue,o as pe,b as me,d as c,e as o,f as n,g as a,h as y,t as r,i as q,j as fe,k as ye,l as w,m as i,n as P,F as Q,p as L,q as X,s as Y,v as T,x as ve}from"./index-DptQGFEH.js";import{H as _e,a as u}from"./html5-qrcode-scanner-Bxxo8Jq_.js";const ge={style:{padding:"20px"}},xe={style:{"margin-bottom":"20px"}},we={style:{"margin-bottom":"10px"}},Ce={style:{"text-align":"right","margin-bottom":"20px"}},ke={style:{display:"flex","justify-content":"space-between"}},be={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},$e={style:{flex:"1 1 20%","text-align":"right"}},ce={style:{display:"flex","justify-content":"space-between"}},Ve={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},ze={style:{flex:"1 1 20%","text-align":"right"}},Ne={key:0,style:{"margin-top":"5px"}},Se={style:{"margin-top":"5px"}},Ie={style:{display:"flex","align-items":"center",gap:"5px"}},De={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Te={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Ue={style:{display:"flex","justify-content":"space-between"}},Ee={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Oe={style:{flex:"1 1 20%","text-align":"right"}},Ae={style:{display:"flex","justify-content":"space-between"}},Be={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Je={style:{flex:"1 1 20%","text-align":"right"}},Re={key:0,style:{"margin-top":"5px"}},je={style:{"margin-top":"5px"}},Fe={style:{display:"flex","align-items":"center",gap:"5px"}},Ke={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Me={style:{padding:"10px",maxHeight:"60vh",overflowY:"auto"}},Pe={__name:"AreaDetailView",setup(He){const U=de(),E=ye(),z=U.params.shelfNo,_=U.params.area,f=$(null),k=$(!1),N=$(!1);let p=null;const m=$({id:"",count:1,type:"good"}),S=h(()=>(f.value?.areas[_]||[]).filter(t=>t.type==="good")),O=h(()=>(f.value?.areas[_]||[]).filter(t=>t.type==="bad")),g=$({}),C=re({}),Z=t=>({left:"左侧",center:"中间",right:"右侧"})[t]||t,G=()=>E.push(`/shelf/${z}`),W=async()=>{const t=await fe(z);if(t){f.value=t;for(const e of t.areas[_])e._expanded=!1}},A=t=>t._expanded=!t._expanded,B=t=>{m.value={id:"",count:1,type:t},k.value=!0},ee=async()=>{const t={id:m.value.id,count:m.value.count,name:"",type:m.value.type,_expanded:!1};f.value.areas[_]||(f.value.areas[_]=[]),f.value.areas[_].push(t),g.value[t.id]||(g.value[t.id]=[]),await T(JSON.parse(JSON.stringify(f.value))),le(),k.value=!1},J=async t=>{f.value.areas[_].splice(t,1),await T(JSON.parse(JSON.stringify(f.value)))},x=(t,e,s)=>{const v=t==="good"?S.value:O.value;e<0||e>=v.length||(v[e].count+=s,v[e].count<1&&(v[e].count=1),T(JSON.parse(JSON.stringify(f.value))))},te=(t,e)=>{const s=S.value;if(e<0||e>=s.length)return;const v=s[e].id;E.push(`/product?id=${encodeURIComponent(v)}`)},V=t=>g.value[t]||[],R=t=>{const e=(C[t]||"").trim();e&&(g.value[t]||(g.value[t]=[]),g.value[t].includes(e)||g.value[t].push(e),C[t]="")},j=(t,e)=>{g.value[t]?.splice(e,1)},le=()=>{m.value={id:"",count:1,type:"good"}};ue(N,async t=>{t?(await ve(),setTimeout(()=>{oe()},300)):I()});async function oe(){p||(p=new _e("html5qr-code"));try{await p.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:150},aspectRatio:1.6,formatsToSupport:[u.EAN_13,u.CODE_128,u.EAN_8,u.UPC_A,u.UPC_E,u.CODE_39,u.CODE_93,u.ITF,u.DATA_MATRIX,u.AZTEC,u.QR_CODE,u.PDF_417]},t=>{m.value.id=t,I()},()=>{})}catch(t){alert("扫码失败："+t),I()}}const I=async()=>{if(N.value=!1,p)try{await p.stop(),await p.clear(),p=null}catch(t){console.warn("停止扫码失败：",t)}};return pe(W),me(async()=>{if(p&&p.getState()===2){try{await p.stop()}catch{}p.clear()}}),(t,e)=>{const s=y("el-button"),v=y("el-tag"),D=y("el-input"),F=y("el-table-column"),K=y("el-table"),M=y("el-card"),H=y("el-form-item"),ne=y("el-input-number"),ae=y("el-form"),ie=y("el-dialog");return w(),c("div",ge,[o("div",xe,[n(s,{type:"primary",onClick:G},{default:a(()=>e[7]||(e[7]=[i("返回货架详情")])),_:1,__:[7]})]),o("h2",we,r(q(z))+" - "+r(Z(q(_)))+" 区域",1),o("div",Ce,[n(s,{type:"success",onClick:e[0]||(e[0]=l=>B("good"))},{default:a(()=>e[8]||(e[8]=[i("添加好货")])),_:1,__:[8]}),n(s,{type:"warning",onClick:e[1]||(e[1]=l=>B("bad"))},{default:a(()=>e[9]||(e[9]=[i("添加坏货")])),_:1,__:[9]})]),e[34]||(e[34]=o("h3",null,"好货列表",-1)),n(M,{style:{"margin-bottom":"10px",padding:"0px"}},{default:a(()=>[n(K,{data:S.value,style:{width:"100%"},size:"small",border:""},{default:a(()=>[n(F,{label:"货物信息"},{default:a(l=>[o("div",ke,[o("div",be,[e[10]||(e[10]=o("strong",null,"编号:",-1)),i(" "+r(l.row.id),1)]),o("div",$e,[e[11]||(e[11]=o("strong",null,"数量:",-1)),i(" "+r(l.row.count),1)])]),o("div",ce,[o("div",Ve,[e[12]||(e[12]=o("strong",null,"名称:",-1)),i(" "+r(V(l.row.id)[0]||"无"),1)]),o("div",ze,[n(s,{size:"small",text:"",onClick:d=>A(l.row)},{default:a(()=>[i(r(l.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),l.row._expanded?(w(),c("div",Ne,[e[19]||(e[19]=o("div",null,[o("strong",null,"标签:")],-1)),o("div",Se,[(w(!0),c(Q,null,L(V(l.row.id),(d,b)=>(w(),X(v,{key:b,closable:"",onClose:se=>j(l.row.id,b),style:{margin:"2px"}},{default:a(()=>[i(r(d),1)]),_:2},1032,["onClose"]))),128)),n(D,{modelValue:C[l.row.id],"onUpdate:modelValue":d=>C[l.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:Y(d=>R(l.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[20]||(e[20]=o("div",{style:{"margin-top":"5px"}},[o("strong",null,"操作:")],-1)),o("div",Ie,[n(s,{size:"small",type:"primary",onClick:d=>x("good",l.$index,1)},{default:a(()=>e[13]||(e[13]=[i("+1")])),_:2,__:[13]},1032,["onClick"]),n(s,{size:"small",type:"primary",onClick:d=>x("good",l.$index,10)},{default:a(()=>e[14]||(e[14]=[i("+10")])),_:2,__:[14]},1032,["onClick"]),n(s,{size:"small",type:"danger",onClick:d=>J("good",l.$index),style:{"margin-left":"auto"}},{default:a(()=>e[15]||(e[15]=[i(" 删除 ")])),_:2,__:[15]},1032,["onClick"])]),o("div",De,[n(s,{size:"small",type:"primary",onClick:d=>x("good",l.$index,-1)},{default:a(()=>e[16]||(e[16]=[i("-1")])),_:2,__:[16]},1032,["onClick"]),n(s,{size:"small",type:"primary",onClick:d=>x("good",l.$index,-10)},{default:a(()=>e[17]||(e[17]=[i("-10")])),_:2,__:[17]},1032,["onClick"])]),o("div",Te,[n(s,{size:"small",type:"primary",onClick:d=>te("good",l.$index)},{default:a(()=>e[18]||(e[18]=[i("查询所有位置")])),_:2,__:[18]},1032,["onClick"])])])):P("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),e[35]||(e[35]=o("h3",null,"坏货列表",-1)),n(M,{style:{"margin-bottom":"10px",padding:"0px"}},{default:a(()=>[n(K,{data:O.value,style:{width:"100%"},size:"small",border:""},{default:a(()=>[n(F,{label:"货物信息"},{default:a(l=>[o("div",Ue,[o("div",Ee,[e[21]||(e[21]=o("strong",null,"编号:",-1)),i(" "+r(l.row.id),1)]),o("div",Oe,[e[22]||(e[22]=o("strong",null,"数量:",-1)),i(" "+r(l.row.count),1)])]),o("div",Ae,[o("div",Be,[e[23]||(e[23]=o("strong",null,"名称:",-1)),i(" "+r(V(l.row.id)[0]||"无"),1)]),o("div",Je,[n(s,{size:"small",text:"",onClick:d=>A(l.row)},{default:a(()=>[i(r(l.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),l.row._expanded?(w(),c("div",Re,[e[29]||(e[29]=o("div",null,[o("strong",null,"标签:")],-1)),o("div",je,[(w(!0),c(Q,null,L(V(l.row.id),(d,b)=>(w(),X(v,{key:b,closable:"",onClose:se=>j(l.row.id,b),style:{margin:"2px"}},{default:a(()=>[i(r(d),1)]),_:2},1032,["onClose"]))),128)),n(D,{modelValue:C[l.row.id],"onUpdate:modelValue":d=>C[l.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:Y(d=>R(l.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[30]||(e[30]=o("div",{style:{"margin-top":"5px"}},[o("strong",null,"操作:")],-1)),o("div",Fe,[n(s,{size:"small",type:"primary",onClick:d=>x("bad",l.$index,1)},{default:a(()=>e[24]||(e[24]=[i("+1")])),_:2,__:[24]},1032,["onClick"]),n(s,{size:"small",type:"primary",onClick:d=>x("bad",l.$index,10)},{default:a(()=>e[25]||(e[25]=[i("+10")])),_:2,__:[25]},1032,["onClick"]),n(s,{size:"small",type:"danger",onClick:d=>J("bad",l.$index),style:{"margin-left":"auto"}},{default:a(()=>e[26]||(e[26]=[i(" 删除 ")])),_:2,__:[26]},1032,["onClick"])]),o("div",Ke,[n(s,{size:"small",type:"primary",onClick:d=>x("bad",l.$index,-1)},{default:a(()=>e[27]||(e[27]=[i("-1")])),_:2,__:[27]},1032,["onClick"]),n(s,{size:"small",type:"primary",onClick:d=>x("bad",l.$index,-10)},{default:a(()=>e[28]||(e[28]=[i("-10")])),_:2,__:[28]},1032,["onClick"])])])):P("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),n(ie,{title:m.value.type==="bad"?"添加坏货":"添加好货",modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=l=>k.value=l),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0},{footer:a(()=>[n(s,{onClick:e[5]||(e[5]=l=>k.value=!1)},{default:a(()=>e[32]||(e[32]=[i("取消")])),_:1,__:[32]}),n(s,{type:"primary",onClick:ee},{default:a(()=>e[33]||(e[33]=[i("确定")])),_:1,__:[33]})]),default:a(()=>[o("div",Me,[n(ae,{"label-position":"top","label-width":"80px"},{default:a(()=>[n(H,{label:"货物ID"},{default:a(()=>[n(D,{modelValue:m.value.id,"onUpdate:modelValue":e[2]||(e[2]=l=>m.value.id=l)},null,8,["modelValue"]),n(s,{type:"primary",plain:"",size:"small",style:{"margin-top":"5px"},onClick:e[3]||(e[3]=l=>N.value=!0)},{default:a(()=>e[31]||(e[31]=[i("扫码输入")])),_:1,__:[31]})]),_:1}),n(H,{label:"数量"},{default:a(()=>[n(ne,{modelValue:m.value.count,"onUpdate:modelValue":e[4]||(e[4]=l=>m.value.count=l),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["title","modelValue"])])}}};export{Pe as default};
