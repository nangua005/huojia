import{_ as j,r as $,w as R,o as ie,c as N,a as x,b as s,d as l,t as C,e as u,f as m,g as V,n as de,E as U,h as J,i as h,F as M,j as E,u as S,k as A,l as ue,m as re,p as Z,q as me,s as G,v as ce,x as ve,y as pe,z as W,A as fe,B as ye,C as ge,D as _e,G as F}from"./index-DYAiqNNJ.js";const we={class:"scan-container"},be={style:{"margin-top":"10px","word-break":"break-all"}},Ve={__name:"ScanDialog",props:{modelValue:Boolean},emits:["update:modelValue","success"],setup(c,{emit:D}){const p=c,y=D,a=$(p.modelValue);R(()=>p.modelValue,d=>a.value=d),R(a,d=>y("update:modelValue",d));const n=$(null),_=$("等待扫码...");let k=null,g=null;const f=async()=>{try{g&&g.getTracks().forEach(d=>d.stop())}catch(d){console.warn("关闭摄像头失败：",d)}g=null,n.value&&(n.value.pause(),n.value.srcObject=null)},e=async()=>{_.value="等待扫码...",await de(),await ZXingBrowser.BrowserQRCodeReader.wasmBindingsReady;const r=(await navigator.mediaDevices.enumerateDevices()).find(v=>v.kind==="videoinput");if(!r){_.value="❌ 没有找到摄像头";return}try{for(g=await navigator.mediaDevices.getUserMedia({video:{deviceId:r.deviceId,facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),n.value.srcObject=g,await new Promise(v=>{const T=()=>{n.value.removeEventListener("canplay",T),v()};n.value.addEventListener("canplay",T)}),k||(k=new ZXingBrowser.BrowserMultiFormatReader);a.value;){try{const v=await k.decodeOnceFromVideoElement(n.value);if(v){const T=v.getText();_.value="✅ 扫码成功："+T,y("success",T),setTimeout(()=>{t()},1500);break}}catch{}await new Promise(v=>setTimeout(v,60))}}catch(v){_.value="❌ 摄像头启动失败："+v}},t=async()=>{a.value=!1,await f()};return R(a,d=>{d&&e()}),ie(f),(d,r)=>{const v=V("el-button"),T=V("el-dialog");return x(),N(T,{title:"扫码输入",modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=b=>a.value=b),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0,onClose:t},{footer:s(()=>[u(v,{onClick:t},{default:s(()=>r[3]||(r[3]=[m("取消")])),_:1,__:[3]})]),default:s(()=>[l("div",we,[l("video",{ref_key:"videoRef",ref:n,autoplay:"",muted:"",playsinline:"",class:"scan-video"},null,512),r[1]||(r[1]=l("div",{class:"scan-frame"},[l("div",{class:"scan-line"})],-1)),r[2]||(r[2]=l("div",{class:"scan-tip"},"请将条码放入红框中进行扫描",-1))]),l("div",be,C(_.value),1)]),_:1},8,["modelValue"])}}},xe=j(Ve,[["__scopeId","data-v-9a954ae2"]]),ke={style:{padding:"10px","max-height":"60vh","overflow-y":"auto"}},Ce={__name:"AddItemDialog",props:{modelValue:Boolean,item:Object},emits:["update:modelValue","confirm","request-scan"],setup(c,{emit:D}){const p=c,y=D,a=$(p.modelValue);R(()=>p.modelValue,f=>a.value=f),R(a,f=>y("update:modelValue",f));const n=async()=>{try{await navigator.clipboard.writeText(item.id),U.success("已复制到剪贴板")}catch{U.error("复制失败")}},_=async()=>{try{const f=await navigator.clipboard.readText();item.id=f,U.success("已粘贴剪贴板内容")}catch{U.error("粘贴失败")}},k=()=>{y("request-scan",f=>{item.id=f})},g=()=>y("confirm");return(f,e)=>{const t=V("el-input"),d=V("el-button"),r=V("el-form-item"),v=V("el-input-number"),T=V("el-form"),b=V("el-dialog");return x(),N(b,{title:c.item.type==="bad"?"添加坏货":"添加好货",modelValue:a.value,"onUpdate:modelValue":e[3]||(e[3]=B=>a.value=B),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0},{footer:s(()=>[u(d,{onClick:e[2]||(e[2]=B=>a.value=!1)},{default:s(()=>e[7]||(e[7]=[m("取消")])),_:1,__:[7]}),u(d,{type:"primary",onClick:g},{default:s(()=>e[8]||(e[8]=[m("确定")])),_:1,__:[8]})]),default:s(()=>[l("div",ke,[u(T,{"label-position":"top","label-width":"80px"},{default:s(()=>[u(r,{label:"货物ID"},{default:s(()=>[u(t,{modelValue:c.item.id,"onUpdate:modelValue":e[0]||(e[0]=B=>c.item.id=B)},null,8,["modelValue"]),u(d,{type:"primary",plain:"",size:"small",style:{"margin-top":"5px"},onClick:k},{default:s(()=>e[4]||(e[4]=[m("扫码输入")])),_:1,__:[4]}),u(d,{type:"primary",plain:"",size:"small",onClick:n},{default:s(()=>e[5]||(e[5]=[m("复制")])),_:1,__:[5]}),u(d,{type:"primary",plain:"",size:"small",onClick:_},{default:s(()=>e[6]||(e[6]=[m("粘贴")])),_:1,__:[6]})]),_:1}),u(r,{label:"数量"},{default:s(()=>[u(v,{modelValue:c.item.count,"onUpdate:modelValue":e[1]||(e[1]=B=>c.item.count=B),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["title","modelValue"])}}},$e={class:"number-display"},De={class:"number-table"},Te={class:"actions"},Be={__name:"NumberPadDialog",props:{modelValue:Boolean,title:{type:String,default:"请输入数量"}},emits:["update:modelValue","confirm"],setup(c,{emit:D}){const p=c,y=D,a=J({get:()=>p.modelValue,set:e=>y("update:modelValue",e)}),n=$(""),_=[["1","2","3"],["4","5","6"],["7","8","9"],["清空","0","←"]],k=e=>{e==="清空"?n.value="":e==="←"?n.value=n.value.slice(0,-1):n.value+=e},g=()=>{const e=parseInt(n.value);isNaN(e)||(y("confirm",e),a.value=!1,n.value="")},f=()=>{a.value=!1,n.value=""};return(e,t)=>(x(),N(S(ue),{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=d=>a.value=d),title:c.title,width:"260px","close-on-click-modal":!1,"destroy-on-close":!0},{default:s(()=>[l("div",$e,C(n.value||"0"),1),l("table",De,[l("tbody",null,[(x(),h(M,null,E(_,d=>l("tr",{key:d.join("-")},[(x(!0),h(M,null,E(d,r=>(x(),h("td",{key:r,class:"key-cell"},[u(S(A),{class:"number-btn",onClick:v=>k(r),type:"default"},{default:s(()=>[m(C(r),1)]),_:2},1032,["onClick"])]))),128))])),64))])]),l("div",Te,[u(S(A),{type:"primary",onClick:g},{default:s(()=>t[1]||(t[1]=[m("确认")])),_:1,__:[1]}),u(S(A),{onClick:f},{default:s(()=>t[2]||(t[2]=[m("取消")])),_:1,__:[2]})])]),_:1},8,["modelValue","title"]))}},Ie=j(Be,[["__scopeId","data-v-acd4044a"]]),Y=({title:c="请输入数量",onConfirm:D})=>{const p=document.createElement("div");document.body.appendChild(p);const y=re(Ie,{modelValue:!0,title:c,"onUpdate:modelValue":a=>{a||(Z(null,p),p.remove())},onConfirm:a=>{D&&D(a)}});Z(y,p)},Se={class:"section"},Ne={class:"content"},Ue={class:"section"},Re={class:"quantity-control-row"},he={class:"quantity-value"},ze={class:"count-button-group"},Me={class:"section"},Ee={class:"tags"},Oe={class:"tag-input"},je={class:"button-row"},qe={__name:"ItemDetailDialog",props:{modelValue:Boolean,item:Object,tags:Array},emits:["update:modelValue","delete","query","update-tags"],setup(c,{emit:D}){const p=c,y=D,a=$(p.modelValue);R(()=>p.modelValue,e=>a.value=e),R(a,e=>y("update:modelValue",e));const n=$("");$([]);const _=async()=>{const e=n.value.trim();if(!e||p.tags.includes(e))return;const t=[...p.tags,e];y("update-tags",t),await ce(e),n.value=""},k=async(e,t)=>{const d=await ve(e);t(d.map(r=>({value:r})))},g=e=>{G.confirm("确定要删除此标签吗？","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}).then(()=>{const t=[...p.tags];t.splice(e,1),y("update-tags",t)}).catch(()=>{})},f=()=>{G.confirm("确定要删除该货物吗？此操作不可撤销。","警告",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{y("delete",p.item.rid)}).catch(()=>{})};return(e,t)=>{const d=V("el-button"),r=V("el-tag"),v=V("el-autocomplete"),T=V("el-dialog");return x(),N(T,{modelValue:a.value,"onUpdate:modelValue":t[4]||(t[4]=b=>a.value=b),title:"货物详情",width:"95%","close-on-click-modal":!1,"destroy-on-close":!0,style:{maxHeight:"80vh"}},{default:s(()=>[l("div",Se,[t[5]||(t[5]=l("div",{class:"label"},"编号：",-1)),l("div",Ne,C(c.item.id),1)]),l("div",Ue,[t[8]||(t[8]=l("div",{class:"label"},"数量：",-1)),l("div",Re,[l("div",he,C(c.item.count),1),l("div",ze,[u(d,{size:"small",onClick:t[0]||(t[0]=()=>S(Y)({title:"减少数量",onConfirm:b=>c.item.count=Math.max(1,c.item.count-b)}))},{default:s(()=>t[6]||(t[6]=[m("-")])),_:1,__:[6]}),u(d,{size:"small",type:"primary",onClick:t[1]||(t[1]=()=>S(Y)({title:"增加数量",onConfirm:b=>c.item.count+=b}))},{default:s(()=>t[7]||(t[7]=[m("+")])),_:1,__:[7]})])])]),l("div",Me,[t[10]||(t[10]=l("div",{class:"label"},"标签：",-1)),l("div",Ee,[(x(!0),h(M,null,E(c.tags,(b,B)=>(x(),N(r,{key:B,closable:"",onClose:P=>g(B),size:"default"},{default:s(()=>[m(C(b),1)]),_:2},1032,["onClose"]))),128))]),l("div",Oe,[u(v,{modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=b=>n.value=b),"fetch-suggestions":k,placeholder:"输入标签后回车添加",size:"default",onKeyup:me(_,["enter"])},null,8,["modelValue"]),u(d,{size:"default",type:"primary",onClick:_},{default:s(()=>t[9]||(t[9]=[m("添加标签")])),_:1,__:[9]})])]),l("div",je,[u(d,{type:"danger",plain:"",onClick:f},{default:s(()=>t[11]||(t[11]=[m("删除")])),_:1,__:[11]}),u(d,{type:"success",plain:"",onClick:t[3]||(t[3]=b=>y("query",c.item.id))},{default:s(()=>t[12]||(t[12]=[m("查询所有位置")])),_:1,__:[12]})])]),_:1},8,["modelValue"])}}},Ae=j(qe,[["__scopeId","data-v-dfa676f1"]]),Fe={style:{padding:"20px"}},Je={style:{"margin-bottom":"20px"}},Pe={style:{"margin-bottom":"10px"}},Le={style:{"text-align":"right","margin-bottom":"20px"}},He={style:{display:"flex","justify-content":"space-between"}},Ke={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Qe={style:{flex:"1 1 20%","text-align":"right"}},Xe={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Ze={style:{flex:"1"}},Ge={style:{display:"flex","justify-content":"space-between"}},We={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Ye={style:{flex:"1 1 20%","text-align":"right"}},et={style:{display:"flex","justify-content":"space-between","align-items":"center"}},tt={style:{flex:"1"}},lt={__name:"AreaDetailView",setup(c){const D=pe(),p=_e(),y=D.params.shelfNo,a=D.params.area,n=$(null),_=$(!1),k=$(!1),g=$(null),f=$(!1),e=W({id:"",count:1,type:"good"}),t=J(()=>(n.value?.areas[a]||[]).filter(i=>i.type==="good")),d=J(()=>(n.value?.areas[a]||[]).filter(i=>i.type==="bad")),r=$({});W({});let v=null;const T=i=>{v=i,k.value=!0},b=i=>{v&&(v(i),v=null),k.value=!1},B=i=>({left:"左侧",center:"中间",right:"右侧"})[i]||i,P=()=>p.push(`/shelf/${y}`),ee=async()=>{const i=await ge(y);if(i){n.value=i,r.value=i.tagMap||{};for(const o of i.areas[a])o._expanded=!1}},L=i=>{e.id="",e.count=1,e.type=i,_.value=!0},te=()=>`${Date.now()}-${Math.floor(Math.random()*1e5)}`,le=async()=>{const i={id:e.id,count:e.count,name:"",type:e.type,_expanded:!1,rid:te()};n.value.areas[a]||(n.value.areas[a]=[]),n.value.areas[a].push(i),r.value[i.id]||(r.value[i.id]=[]),await F(JSON.parse(JSON.stringify(n.value))),oe(),_.value=!1},H=i=>r.value[i]||[],oe=()=>{e.id="",e.count=1,e.type="good"},K=i=>{g.value=i,f.value=!0},ae=async i=>{if(!g.value||!g.value.id){U.error("未选择货物，无法更新标签");return}const o=g.value.id;r.value[o]=i,n.value.tagMap=r.value;try{await F(JSON.parse(JSON.stringify(n.value))),U.success("标签已保存")}catch(I){console.error("保存标签失败:",I),U.error("保存标签失败")}},ne=async i=>{console.log("Removing item with rid:",i);const o=n.value.areas[a],I=o.findIndex(O=>O.rid===i);I!==-1&&(o.splice(I,1),await F(JSON.parse(JSON.stringify(n.value)))),f.value=!1},se=i=>{p.push(`/product?id=${encodeURIComponent(i)}`)};return fe(ee),(i,o)=>{const I=V("el-button"),O=V("el-tag"),Q=V("el-table-column"),X=V("el-table");return x(),h("div",Fe,[l("div",Je,[u(I,{type:"primary",onClick:P},{default:s(()=>o[5]||(o[5]=[m("返回货架详情")])),_:1,__:[5]})]),l("h2",Pe,C(S(y))+" - "+C(B(S(a)))+" 区域",1),l("div",Le,[u(I,{type:"success",onClick:o[0]||(o[0]=w=>L("good"))},{default:s(()=>o[6]||(o[6]=[m("添加好货")])),_:1,__:[6]}),u(I,{type:"warning",onClick:o[1]||(o[1]=w=>L("bad"))},{default:s(()=>o[7]||(o[7]=[m("添加坏货")])),_:1,__:[7]})]),o[14]||(o[14]=l("h3",null,"好货列表",-1)),u(X,{data:t.value,style:{width:"100%"},size:"small",border:""},{default:s(()=>[u(Q,{label:"货物信息"},{default:s(w=>[l("div",He,[l("div",Ke,[o[8]||(o[8]=l("strong",null,"编号:",-1)),m(" "+C(w.row.id),1)]),l("div",Qe,[o[9]||(o[9]=l("strong",null,"数量:",-1)),m(" "+C(w.row.count),1)])]),l("div",Xe,[l("div",Ze,[(x(!0),h(M,null,E(H(w.row.id).slice(0,2),(z,q)=>(x(),N(O,{key:q,style:{margin:"2px"}},{default:s(()=>[m(C(z),1)]),_:2},1024))),128))]),u(I,{size:"small",onClick:z=>K(w.row)},{default:s(()=>o[10]||(o[10]=[m("详情")])),_:2,__:[10]},1032,["onClick"])])]),_:1})]),_:1},8,["data"]),o[15]||(o[15]=l("h3",null,"坏货列表",-1)),u(X,{data:d.value,style:{width:"100%"},size:"small",border:""},{default:s(()=>[u(Q,{label:"货物信息"},{default:s(w=>[l("div",Ge,[l("div",We,[o[11]||(o[11]=l("strong",null,"编号:",-1)),m(" "+C(w.row.id),1)]),l("div",Ye,[o[12]||(o[12]=l("strong",null,"数量:",-1)),m(" "+C(w.row.count),1)])]),l("div",et,[l("div",tt,[(x(!0),h(M,null,E(H(w.row.id).slice(0,2),(z,q)=>(x(),N(O,{key:q,style:{margin:"2px"}},{default:s(()=>[m(C(z),1)]),_:2},1024))),128))]),u(I,{size:"small",onClick:z=>K(w.row)},{default:s(()=>o[13]||(o[13]=[m("详情")])),_:2,__:[13]},1032,["onClick"])])]),_:1})]),_:1},8,["data"]),u(Ce,{modelValue:_.value,"onUpdate:modelValue":o[2]||(o[2]=w=>_.value=w),item:e,onConfirm:le,onRequestScan:T},null,8,["modelValue","item"]),u(xe,{modelValue:k.value,"onUpdate:modelValue":o[3]||(o[3]=w=>k.value=w),onSuccess:b},null,8,["modelValue"]),g.value?(x(),N(Ae,{key:0,modelValue:f.value,"onUpdate:modelValue":o[4]||(o[4]=w=>f.value=w),item:g.value,tags:r.value[g.value.id]||[],onUpdateTags:ae,onDelete:ne,onQuery:se},null,8,["modelValue","item","tags"])):ye("",!0)])}}},at=j(lt,[["__scopeId","data-v-589ba951"]]);export{at as default};
