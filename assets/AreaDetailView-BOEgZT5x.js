import{_ as me,u as ve,r as x,c as Q,a as fe,w as ye,o as ge,b as _e,d as z,e as l,f as n,g as i,h as v,t as r,i as Y,j as xe,k as we,l as w,m as s,n as G,F as P,p as W,q as ee,s as te,v as U,x as ke}from"./index-BvkxmoXs.js";import"./html5-qrcode-scanner-iNFhig4x.js";const be={style:{padding:"20px"}},Ce={style:{"margin-bottom":"20px"}},ce={style:{"margin-bottom":"10px"}},$e={style:{"text-align":"right","margin-bottom":"20px"}},Ve={style:{display:"flex","justify-content":"space-between"}},ze={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Ie={style:{flex:"1 1 20%","text-align":"right"}},Ne={style:{display:"flex","justify-content":"space-between"}},Se={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Be={style:{flex:"1 1 20%","text-align":"right"}},De={key:0,style:{"margin-top":"5px"}},Ue={style:{"margin-top":"5px"}},Re={style:{display:"flex","align-items":"center",gap:"5px"}},Oe={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Te={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},je={style:{display:"flex","justify-content":"space-between"}},Je={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Me={style:{flex:"1 1 20%","text-align":"right"}},Ke={style:{display:"flex","justify-content":"space-between"}},Fe={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Ae={style:{flex:"1 1 20%","text-align":"right"}},Ee={key:0,style:{"margin-top":"5px"}},Le={style:{"margin-top":"5px"}},Xe={style:{display:"flex","align-items":"center",gap:"5px"}},Ze={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},he={style:{padding:"10px",maxHeight:"60vh",overflowY:"auto"}},qe={style:{"margin-top":"10px","word-break":"break-all"}},He={__name:"AreaDetailView",setup(Qe){const R=ve(),O=we(),S=R.params.shelfNo,f=R.params.area,p=x(null),b=x(!1),C=x(!1),u=x({id:"",count:1,type:"good"}),B=Q(()=>(p.value?.areas[f]||[]).filter(o=>o.type==="good")),T=Q(()=>(p.value?.areas[f]||[]).filter(o=>o.type==="bad")),y=x({}),k=fe({}),le=o=>({left:"左侧",center:"中间",right:"右侧"})[o]||o,oe=()=>O.push(`/shelf/${S}`),ne=async()=>{const o=await xe(S);if(o){p.value=o;for(const e of o.areas[f])e._expanded=!1}},j=o=>o._expanded=!o._expanded,J=o=>{u.value={id:"",count:1,type:o},b.value=!0},ie=async()=>{const o={id:u.value.id,count:u.value.count,name:"",type:u.value.type,_expanded:!1};p.value.areas[f]||(p.value.areas[f]=[]),p.value.areas[f].push(o),y.value[o.id]||(y.value[o.id]=[]),await U(JSON.parse(JSON.stringify(p.value))),se(),b.value=!1},M=async o=>{p.value.areas[f].splice(o,1),await U(JSON.parse(JSON.stringify(p.value)))},g=(o,e,a)=>{const m=o==="good"?B.value:T.value;e<0||e>=m.length||(m[e].count+=a,m[e].count<1&&(m[e].count=1),U(JSON.parse(JSON.stringify(p.value))))},ae=(o,e)=>{const a=B.value;if(e<0||e>=a.length)return;const m=a[e].id;O.push(`/product?id=${encodeURIComponent(m)}`)},I=o=>y.value[o]||[],K=o=>{const e=(k[o]||"").trim();e&&(y.value[o]||(y.value[o]=[]),y.value[o].includes(e)||y.value[o].push(e),k[o]="")},F=(o,e)=>{y.value[o]?.splice(e,1)},se=()=>{u.value={id:"",count:1,type:"good"}},D=x(null),c=x("等待扫码...");let A=null,E=null,L="",X=0;ye(C,async o=>{o?de():N()});const de=async()=>{await ke(),c.value="等待扫码...",await ZXingBrowser.BrowserQRCodeReader.wasmBindingsReady;const e=(await navigator.mediaDevices.enumerateDevices()).find(a=>a.kind==="videoinput");if(!e){c.value="❌ 没有找到摄像头";return}try{E=await navigator.mediaDevices.getUserMedia({video:{deviceId:e.deviceId,facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}}),D.value.srcObject=E,A=new ZXingBrowser.BrowserMultiFormatReader,A.decodeFromVideoElementContinuously(D.value,(a,m)=>{if(a){const _=a.getText(),$=Date.now();(_!==L||$-X>1500)&&(L=_,X=$,c.value="✅ 扫码成功："+_,u.value.id=_,N())}})}catch(a){c.value="❌ 摄像头启动失败："+a}},N=async()=>{C.value=!1};return ge(ne),_e(async()=>{}),(o,e)=>{const a=v("el-button"),m=v("el-tag"),_=v("el-input"),$=v("el-table-column"),Z=v("el-table"),h=v("el-card"),q=v("el-form-item"),re=v("el-input-number"),ue=v("el-form"),H=v("el-dialog");return w(),z("div",be,[l("div",Ce,[n(a,{type:"primary",onClick:oe},{default:i(()=>e[8]||(e[8]=[s("返回货架详情")])),_:1,__:[8]})]),l("h2",ce,r(Y(S))+" - "+r(le(Y(f)))+" 区域",1),l("div",$e,[n(a,{type:"success",onClick:e[0]||(e[0]=t=>J("good"))},{default:i(()=>e[9]||(e[9]=[s("添加好货")])),_:1,__:[9]}),n(a,{type:"warning",onClick:e[1]||(e[1]=t=>J("bad"))},{default:i(()=>e[10]||(e[10]=[s("添加坏货")])),_:1,__:[10]})]),e[36]||(e[36]=l("h3",null,"好货列表",-1)),n(h,{style:{"margin-bottom":"10px",padding:"0px"}},{default:i(()=>[n(Z,{data:B.value,style:{width:"100%"},size:"small",border:""},{default:i(()=>[n($,{label:"货物信息"},{default:i(t=>[l("div",Ve,[l("div",ze,[e[11]||(e[11]=l("strong",null,"编号:",-1)),s(" "+r(t.row.id),1)]),l("div",Ie,[e[12]||(e[12]=l("strong",null,"数量:",-1)),s(" "+r(t.row.count),1)])]),l("div",Ne,[l("div",Se,[e[13]||(e[13]=l("strong",null,"名称:",-1)),s(" "+r(I(t.row.id)[0]||"无"),1)]),l("div",Be,[n(a,{size:"small",text:"",onClick:d=>j(t.row)},{default:i(()=>[s(r(t.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),t.row._expanded?(w(),z("div",De,[e[20]||(e[20]=l("div",null,[l("strong",null,"标签:")],-1)),l("div",Ue,[(w(!0),z(P,null,W(I(t.row.id),(d,V)=>(w(),ee(m,{key:V,closable:"",onClose:pe=>F(t.row.id,V),style:{margin:"2px"}},{default:i(()=>[s(r(d),1)]),_:2},1032,["onClose"]))),128)),n(_,{modelValue:k[t.row.id],"onUpdate:modelValue":d=>k[t.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:te(d=>K(t.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[21]||(e[21]=l("div",{style:{"margin-top":"5px"}},[l("strong",null,"操作:")],-1)),l("div",Re,[n(a,{size:"small",type:"primary",onClick:d=>g("good",t.$index,1)},{default:i(()=>e[14]||(e[14]=[s("+1")])),_:2,__:[14]},1032,["onClick"]),n(a,{size:"small",type:"primary",onClick:d=>g("good",t.$index,10)},{default:i(()=>e[15]||(e[15]=[s("+10")])),_:2,__:[15]},1032,["onClick"]),n(a,{size:"small",type:"danger",onClick:d=>M("good",t.$index),style:{"margin-left":"auto"}},{default:i(()=>e[16]||(e[16]=[s(" 删除 ")])),_:2,__:[16]},1032,["onClick"])]),l("div",Oe,[n(a,{size:"small",type:"primary",onClick:d=>g("good",t.$index,-1)},{default:i(()=>e[17]||(e[17]=[s("-1")])),_:2,__:[17]},1032,["onClick"]),n(a,{size:"small",type:"primary",onClick:d=>g("good",t.$index,-10)},{default:i(()=>e[18]||(e[18]=[s("-10")])),_:2,__:[18]},1032,["onClick"])]),l("div",Te,[n(a,{size:"small",type:"primary",onClick:d=>ae("good",t.$index)},{default:i(()=>e[19]||(e[19]=[s("查询所有位置")])),_:2,__:[19]},1032,["onClick"])])])):G("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),e[37]||(e[37]=l("h3",null,"坏货列表",-1)),n(h,{style:{"margin-bottom":"10px",padding:"0px"}},{default:i(()=>[n(Z,{data:T.value,style:{width:"100%"},size:"small",border:""},{default:i(()=>[n($,{label:"货物信息"},{default:i(t=>[l("div",je,[l("div",Je,[e[22]||(e[22]=l("strong",null,"编号:",-1)),s(" "+r(t.row.id),1)]),l("div",Me,[e[23]||(e[23]=l("strong",null,"数量:",-1)),s(" "+r(t.row.count),1)])]),l("div",Ke,[l("div",Fe,[e[24]||(e[24]=l("strong",null,"名称:",-1)),s(" "+r(I(t.row.id)[0]||"无"),1)]),l("div",Ae,[n(a,{size:"small",text:"",onClick:d=>j(t.row)},{default:i(()=>[s(r(t.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),t.row._expanded?(w(),z("div",Ee,[e[30]||(e[30]=l("div",null,[l("strong",null,"标签:")],-1)),l("div",Le,[(w(!0),z(P,null,W(I(t.row.id),(d,V)=>(w(),ee(m,{key:V,closable:"",onClose:pe=>F(t.row.id,V),style:{margin:"2px"}},{default:i(()=>[s(r(d),1)]),_:2},1032,["onClose"]))),128)),n(_,{modelValue:k[t.row.id],"onUpdate:modelValue":d=>k[t.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:te(d=>K(t.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[31]||(e[31]=l("div",{style:{"margin-top":"5px"}},[l("strong",null,"操作:")],-1)),l("div",Xe,[n(a,{size:"small",type:"primary",onClick:d=>g("bad",t.$index,1)},{default:i(()=>e[25]||(e[25]=[s("+1")])),_:2,__:[25]},1032,["onClick"]),n(a,{size:"small",type:"primary",onClick:d=>g("bad",t.$index,10)},{default:i(()=>e[26]||(e[26]=[s("+10")])),_:2,__:[26]},1032,["onClick"]),n(a,{size:"small",type:"danger",onClick:d=>M("bad",t.$index),style:{"margin-left":"auto"}},{default:i(()=>e[27]||(e[27]=[s(" 删除 ")])),_:2,__:[27]},1032,["onClick"])]),l("div",Ze,[n(a,{size:"small",type:"primary",onClick:d=>g("bad",t.$index,-1)},{default:i(()=>e[28]||(e[28]=[s("-1")])),_:2,__:[28]},1032,["onClick"]),n(a,{size:"small",type:"primary",onClick:d=>g("bad",t.$index,-10)},{default:i(()=>e[29]||(e[29]=[s("-10")])),_:2,__:[29]},1032,["onClick"])])])):G("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),n(H,{title:u.value.type==="bad"?"添加坏货":"添加好货",modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=t=>b.value=t),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0},{footer:i(()=>[n(a,{onClick:e[5]||(e[5]=t=>b.value=!1)},{default:i(()=>e[33]||(e[33]=[s("取消")])),_:1,__:[33]}),n(a,{type:"primary",onClick:ie},{default:i(()=>e[34]||(e[34]=[s("确定")])),_:1,__:[34]})]),default:i(()=>[l("div",he,[n(ue,{"label-position":"top","label-width":"80px"},{default:i(()=>[n(q,{label:"货物ID"},{default:i(()=>[n(_,{modelValue:u.value.id,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value.id=t)},null,8,["modelValue"]),n(a,{type:"primary",plain:"",size:"small",style:{"margin-top":"5px"},onClick:e[3]||(e[3]=t=>C.value=!0)},{default:i(()=>e[32]||(e[32]=[s("扫码输入")])),_:1,__:[32]})]),_:1}),n(q,{label:"数量"},{default:i(()=>[n(re,{modelValue:u.value.count,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.count=t),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["title","modelValue"]),n(H,{title:"扫码输入",modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=t=>C.value=t),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0,onClose:N},{footer:i(()=>[n(a,{onClick:N},{default:i(()=>e[35]||(e[35]=[s("取消")])),_:1,__:[35]})]),default:i(()=>[l("video",{ref_key:"videoRef",ref:D,autoplay:"",muted:"",playsinline:"",style:{width:"100%","max-height":"260px",border:"1px solid #ccc"}},null,512),l("div",qe,r(c.value),1)]),_:1},8,["modelValue"])])}}},Pe=me(He,[["__scopeId","data-v-ad88cc11"]]);export{Pe as default};
