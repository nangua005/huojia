import{_ as ee,r as C,w as R,o as de,c as E,a as b,b as a,d as l,t as y,e as n,f as s,g as _,n as re,u as ue,h as q,i as me,j as pe,k as N,l as H,m as ve,p as fe,q as Q,F as Y,s as G,v as W,x as j}from"./index-CbhPmmsN.js";const ye={class:"scan-container"},ge={style:{"margin-top":"10px","word-break":"break-all"}},_e={__name:"ScanDialog",props:{modelValue:Boolean},emits:["update:modelValue","success"],setup(J,{emit:B}){const I=J,$=B,p=C(I.modelValue);R(()=>I.modelValue,u=>p.value=u),R(p,u=>$("update:modelValue",u));const r=C(null),x=C("等待扫码...");let V=null,m=null;const z=async()=>{try{m&&m.getTracks().forEach(u=>u.stop())}catch(u){console.warn("关闭摄像头失败：",u)}m=null,r.value&&(r.value.pause(),r.value.srcObject=null)},D=async()=>{x.value="等待扫码...",await re(),await ZXingBrowser.BrowserQRCodeReader.wasmBindingsReady;const f=(await navigator.mediaDevices.enumerateDevices()).find(v=>v.kind==="videoinput");if(!f){x.value="❌ 没有找到摄像头";return}try{for(m=await navigator.mediaDevices.getUserMedia({video:{deviceId:f.deviceId,facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),r.value.srcObject=m,await new Promise(v=>{const w=()=>{r.value.removeEventListener("canplay",w),v()};r.value.addEventListener("canplay",w)}),V||(V=new ZXingBrowser.BrowserMultiFormatReader);p.value;){try{const v=await V.decodeOnceFromVideoElement(r.value);if(v){const w=v.getText();x.value="✅ 扫码成功："+w,$("success",w),setTimeout(()=>{g()},1500);break}}catch{}await new Promise(v=>setTimeout(v,60))}}catch(v){x.value="❌ 摄像头启动失败："+v}},g=async()=>{p.value=!1,await z()};return R(p,u=>{u&&D()}),de(z),(u,f)=>{const v=_("el-button"),w=_("el-dialog");return b(),E(w,{title:"扫码输入",modelValue:p.value,"onUpdate:modelValue":f[0]||(f[0]=T=>p.value=T),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0,onClose:g},{footer:a(()=>[n(v,{onClick:g},{default:a(()=>f[3]||(f[3]=[s("取消")])),_:1,__:[3]})]),default:a(()=>[l("div",ye,[l("video",{ref_key:"videoRef",ref:r,autoplay:"",muted:"",playsinline:"",class:"scan-video"},null,512),f[1]||(f[1]=l("div",{class:"scan-frame"},[l("div",{class:"scan-line"})],-1)),f[2]||(f[2]=l("div",{class:"scan-tip"},"请将条码放入红框中进行扫描",-1))]),l("div",ge,y(x.value),1)]),_:1},8,["modelValue"])}}},xe=ee(_e,[["__scopeId","data-v-9a954ae2"]]),we={style:{padding:"20px"}},ce={style:{"margin-bottom":"20px"}},ke={style:{"margin-bottom":"10px"}},be={style:{"text-align":"right","margin-bottom":"20px"}},Ce={style:{display:"flex","justify-content":"space-between"}},Ve={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},$e={style:{flex:"1 1 20%","text-align":"right"}},ze={style:{display:"flex","justify-content":"space-between"}},Ie={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Se={style:{flex:"1 1 20%","text-align":"right"}},Ne={key:0,style:{"margin-top":"5px"}},Be={style:{"margin-top":"5px"}},De={style:{display:"flex","align-items":"center",gap:"5px"}},Ue={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Te={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Oe={style:{display:"flex","justify-content":"space-between"}},Re={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},je={style:{flex:"1 1 20%","text-align":"right"}},Ee={style:{display:"flex","justify-content":"space-between"}},Je={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Me={style:{flex:"1 1 20%","text-align":"right"}},Ke={key:0,style:{"margin-top":"5px"}},Fe={style:{"margin-top":"5px"}},Le={style:{display:"flex","align-items":"center",gap:"5px"}},Ae={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Pe={style:{padding:"10px",maxHeight:"60vh",overflowY:"auto"}},Xe={__name:"AreaDetailView",setup(J){const B=ue(),I=fe(),$=B.params.shelfNo,p=B.params.area,r=C(null),x=C(!1),V=C(!1),m=C({id:"",count:1,type:"good"}),z=q(()=>(r.value?.areas[p]||[]).filter(o=>o.type==="good")),D=q(()=>(r.value?.areas[p]||[]).filter(o=>o.type==="bad")),g=C({}),u=me({}),f=o=>{m.value.id=o},v=o=>({left:"左侧",center:"中间",right:"右侧"})[o]||o,w=()=>I.push(`/shelf/${$}`),T=async()=>{const o=await ve($);if(o){r.value=o;for(const e of o.areas[p])e._expanded=!1}},M=o=>o._expanded=!o._expanded,K=o=>{m.value={id:"",count:1,type:o},x.value=!0},te=async()=>{const o={id:m.value.id,count:m.value.count,name:"",type:m.value.type,_expanded:!1};r.value.areas[p]||(r.value.areas[p]=[]),r.value.areas[p].push(o),g.value[o.id]||(g.value[o.id]=[]),await j(JSON.parse(JSON.stringify(r.value))),oe(),x.value=!1},F=async o=>{r.value.areas[p].splice(o,1),await j(JSON.parse(JSON.stringify(r.value)))},k=(o,e,i)=>{const c=o==="good"?z.value:D.value;e<0||e>=c.length||(c[e].count+=i,c[e].count<1&&(c[e].count=1),j(JSON.parse(JSON.stringify(r.value))))},le=(o,e)=>{const i=z.value;if(e<0||e>=i.length)return;const c=i[e].id;I.push(`/product?id=${encodeURIComponent(c)}`)},U=o=>g.value[o]||[],L=o=>{const e=(u[o]||"").trim();e&&(g.value[o]||(g.value[o]=[]),g.value[o].includes(e)||g.value[o].push(e),u[o]="")},A=(o,e)=>{g.value[o]?.splice(e,1)},oe=()=>{m.value={id:"",count:1,type:"good"}};return pe(T),(o,e)=>{const i=_("el-button"),c=_("el-tag"),O=_("el-input"),P=_("el-table-column"),X=_("el-table"),Z=_("el-card"),h=_("el-form-item"),ne=_("el-input-number"),ae=_("el-form"),se=_("el-dialog");return b(),N("div",we,[l("div",ce,[n(i,{type:"primary",onClick:w},{default:a(()=>e[8]||(e[8]=[s("返回货架详情")])),_:1,__:[8]})]),l("h2",ke,y(H($))+" - "+y(v(H(p)))+" 区域",1),l("div",be,[n(i,{type:"success",onClick:e[0]||(e[0]=t=>K("good"))},{default:a(()=>e[9]||(e[9]=[s("添加好货")])),_:1,__:[9]}),n(i,{type:"warning",onClick:e[1]||(e[1]=t=>K("bad"))},{default:a(()=>e[10]||(e[10]=[s("添加坏货")])),_:1,__:[10]})]),e[35]||(e[35]=l("h3",null,"好货列表",-1)),n(Z,{style:{"margin-bottom":"10px",padding:"0px"}},{default:a(()=>[n(X,{data:z.value,style:{width:"100%"},size:"small",border:""},{default:a(()=>[n(P,{label:"货物信息"},{default:a(t=>[l("div",Ce,[l("div",Ve,[e[11]||(e[11]=l("strong",null,"编号:",-1)),s(" "+y(t.row.id),1)]),l("div",$e,[e[12]||(e[12]=l("strong",null,"数量:",-1)),s(" "+y(t.row.count),1)])]),l("div",ze,[l("div",Ie,[e[13]||(e[13]=l("strong",null,"名称:",-1)),s(" "+y(U(t.row.id)[0]||"无"),1)]),l("div",Se,[n(i,{size:"small",text:"",onClick:d=>M(t.row)},{default:a(()=>[s(y(t.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),t.row._expanded?(b(),N("div",Ne,[e[20]||(e[20]=l("div",null,[l("strong",null,"标签:")],-1)),l("div",Be,[(b(!0),N(Y,null,G(U(t.row.id),(d,S)=>(b(),E(c,{key:S,closable:"",onClose:ie=>A(t.row.id,S),style:{margin:"2px"}},{default:a(()=>[s(y(d),1)]),_:2},1032,["onClose"]))),128)),n(O,{modelValue:u[t.row.id],"onUpdate:modelValue":d=>u[t.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:W(d=>L(t.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[21]||(e[21]=l("div",{style:{"margin-top":"5px"}},[l("strong",null,"操作:")],-1)),l("div",De,[n(i,{size:"small",type:"primary",onClick:d=>k("good",t.$index,1)},{default:a(()=>e[14]||(e[14]=[s("+1")])),_:2,__:[14]},1032,["onClick"]),n(i,{size:"small",type:"primary",onClick:d=>k("good",t.$index,10)},{default:a(()=>e[15]||(e[15]=[s("+10")])),_:2,__:[15]},1032,["onClick"]),n(i,{size:"small",type:"danger",onClick:d=>F("good",t.$index),style:{"margin-left":"auto"}},{default:a(()=>e[16]||(e[16]=[s(" 删除 ")])),_:2,__:[16]},1032,["onClick"])]),l("div",Ue,[n(i,{size:"small",type:"primary",onClick:d=>k("good",t.$index,-1)},{default:a(()=>e[17]||(e[17]=[s("-1")])),_:2,__:[17]},1032,["onClick"]),n(i,{size:"small",type:"primary",onClick:d=>k("good",t.$index,-10)},{default:a(()=>e[18]||(e[18]=[s("-10")])),_:2,__:[18]},1032,["onClick"])]),l("div",Te,[n(i,{size:"small",type:"primary",onClick:d=>le("good",t.$index)},{default:a(()=>e[19]||(e[19]=[s("查询所有位置")])),_:2,__:[19]},1032,["onClick"])])])):Q("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),e[36]||(e[36]=l("h3",null,"坏货列表",-1)),n(Z,{style:{"margin-bottom":"10px",padding:"0px"}},{default:a(()=>[n(X,{data:D.value,style:{width:"100%"},size:"small",border:""},{default:a(()=>[n(P,{label:"货物信息"},{default:a(t=>[l("div",Oe,[l("div",Re,[e[22]||(e[22]=l("strong",null,"编号:",-1)),s(" "+y(t.row.id),1)]),l("div",je,[e[23]||(e[23]=l("strong",null,"数量:",-1)),s(" "+y(t.row.count),1)])]),l("div",Ee,[l("div",Je,[e[24]||(e[24]=l("strong",null,"名称:",-1)),s(" "+y(U(t.row.id)[0]||"无"),1)]),l("div",Me,[n(i,{size:"small",text:"",onClick:d=>M(t.row)},{default:a(()=>[s(y(t.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),t.row._expanded?(b(),N("div",Ke,[e[30]||(e[30]=l("div",null,[l("strong",null,"标签:")],-1)),l("div",Fe,[(b(!0),N(Y,null,G(U(t.row.id),(d,S)=>(b(),E(c,{key:S,closable:"",onClose:ie=>A(t.row.id,S),style:{margin:"2px"}},{default:a(()=>[s(y(d),1)]),_:2},1032,["onClose"]))),128)),n(O,{modelValue:u[t.row.id],"onUpdate:modelValue":d=>u[t.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:W(d=>L(t.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[31]||(e[31]=l("div",{style:{"margin-top":"5px"}},[l("strong",null,"操作:")],-1)),l("div",Le,[n(i,{size:"small",type:"primary",onClick:d=>k("bad",t.$index,1)},{default:a(()=>e[25]||(e[25]=[s("+1")])),_:2,__:[25]},1032,["onClick"]),n(i,{size:"small",type:"primary",onClick:d=>k("bad",t.$index,10)},{default:a(()=>e[26]||(e[26]=[s("+10")])),_:2,__:[26]},1032,["onClick"]),n(i,{size:"small",type:"danger",onClick:d=>F("bad",t.$index),style:{"margin-left":"auto"}},{default:a(()=>e[27]||(e[27]=[s(" 删除 ")])),_:2,__:[27]},1032,["onClick"])]),l("div",Ae,[n(i,{size:"small",type:"primary",onClick:d=>k("bad",t.$index,-1)},{default:a(()=>e[28]||(e[28]=[s("-1")])),_:2,__:[28]},1032,["onClick"]),n(i,{size:"small",type:"primary",onClick:d=>k("bad",t.$index,-10)},{default:a(()=>e[29]||(e[29]=[s("-10")])),_:2,__:[29]},1032,["onClick"])])])):Q("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),n(se,{title:m.value.type==="bad"?"添加坏货":"添加好货",modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=t=>x.value=t),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0},{footer:a(()=>[n(i,{onClick:e[5]||(e[5]=t=>x.value=!1)},{default:a(()=>e[33]||(e[33]=[s("取消")])),_:1,__:[33]}),n(i,{type:"primary",onClick:te},{default:a(()=>e[34]||(e[34]=[s("确定")])),_:1,__:[34]})]),default:a(()=>[l("div",Pe,[n(ae,{"label-position":"top","label-width":"80px"},{default:a(()=>[n(h,{label:"货物ID"},{default:a(()=>[n(O,{modelValue:m.value.id,"onUpdate:modelValue":e[2]||(e[2]=t=>m.value.id=t)},null,8,["modelValue"]),n(i,{type:"primary",plain:"",size:"small",style:{"margin-top":"5px"},onClick:e[3]||(e[3]=t=>V.value=!0)},{default:a(()=>e[32]||(e[32]=[s("扫码输入")])),_:1,__:[32]})]),_:1}),n(h,{label:"数量"},{default:a(()=>[n(ne,{modelValue:m.value.count,"onUpdate:modelValue":e[4]||(e[4]=t=>m.value.count=t),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["title","modelValue"]),n(xe,{modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=t=>V.value=t),onSuccess:f},null,8,["modelValue"])])}}},he=ee(Xe,[["__scopeId","data-v-4349d378"]]);export{he as default};
