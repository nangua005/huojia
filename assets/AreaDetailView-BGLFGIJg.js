import{_ as pe,u as me,r as x,c as q,a as ve,w as fe,o as ye,b as ge,d as I,e as o,f as a,g as i,h as v,t as u,i as H,j as _e,k as xe,l as w,m as s,n as Q,F as Y,p as G,q as W,s as ee,v as O,x as we}from"./index-l6NgXL-v.js";const ce={style:{padding:"20px"}},ke={style:{"margin-bottom":"20px"}},be={style:{"margin-bottom":"10px"}},Ce={style:{"text-align":"right","margin-bottom":"20px"}},$e={style:{display:"flex","justify-content":"space-between"}},Ve={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},ze={style:{flex:"1 1 20%","text-align":"right"}},Ie={style:{display:"flex","justify-content":"space-between"}},Ne={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Se={style:{flex:"1 1 20%","text-align":"right"}},Be={key:0,style:{"margin-top":"5px"}},Ue={style:{"margin-top":"5px"}},De={style:{display:"flex","align-items":"center",gap:"5px"}},Oe={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Re={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Te={style:{display:"flex","justify-content":"space-between"}},he={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},je={style:{flex:"1 1 20%","text-align":"right"}},Ee={style:{display:"flex","justify-content":"space-between"}},Je={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Me={style:{flex:"1 1 20%","text-align":"right"}},Ke={key:0,style:{"margin-top":"5px"}},Fe={style:{"margin-top":"5px"}},Le={style:{display:"flex","align-items":"center",gap:"5px"}},Ae={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Pe={style:{padding:"10px",maxHeight:"60vh",overflowY:"auto"}},Xe={style:{"margin-top":"10px","word-break":"break-all"}},Ze={__name:"AreaDetailView",setup(qe){const R=me(),T=xe(),S=R.params.shelfNo,f=R.params.area,m=x(null),k=x(!1),b=x(!1),p=x({id:"",count:1,type:"good"}),B=q(()=>(m.value?.areas[f]||[]).filter(t=>t.type==="good")),h=q(()=>(m.value?.areas[f]||[]).filter(t=>t.type==="bad")),y=x({}),c=ve({}),te=t=>({left:"左侧",center:"中间",right:"右侧"})[t]||t,le=()=>T.push(`/shelf/${S}`),oe=async()=>{const t=await _e(S);if(t){m.value=t;for(const e of t.areas[f])e._expanded=!1}},j=t=>t._expanded=!t._expanded,E=t=>{p.value={id:"",count:1,type:t},k.value=!0},ne=async()=>{const t={id:p.value.id,count:p.value.count,name:"",type:p.value.type,_expanded:!1};m.value.areas[f]||(m.value.areas[f]=[]),m.value.areas[f].push(t),y.value[t.id]||(y.value[t.id]=[]),await O(JSON.parse(JSON.stringify(m.value))),ie(),k.value=!1},J=async t=>{m.value.areas[f].splice(t,1),await O(JSON.parse(JSON.stringify(m.value)))},g=(t,e,n)=>{const r=t==="good"?B.value:h.value;e<0||e>=r.length||(r[e].count+=n,r[e].count<1&&(r[e].count=1),O(JSON.parse(JSON.stringify(m.value))))},ae=(t,e)=>{const n=B.value;if(e<0||e>=n.length)return;const r=n[e].id;T.push(`/product?id=${encodeURIComponent(r)}`)},N=t=>y.value[t]||[],M=t=>{const e=(c[t]||"").trim();e&&(y.value[t]||(y.value[t]=[]),y.value[t].includes(e)||y.value[t].push(e),c[t]="")},K=(t,e)=>{y.value[t]?.splice(e,1)},ie=()=>{p.value={id:"",count:1,type:"good"}},_=x(null),C=x("等待扫码...");let U=null,$=null;fe(b,t=>{t?se():V()});const F=()=>{C.value="等待扫码..."},V=async()=>{b.value=!1,F();try{$&&$.getTracks().forEach(t=>t.stop())}catch(t){console.warn("扫码停止失败：",t),alert("扫码停止失败："+t)}$=null;try{_.value&&(_.value.pause(),_.value.srcObject=null)}catch(t){console.warn("视频元素清理失败："+t),alert("视频元素清理失败：")}},se=async()=>{F(),await we(),C.value="等待扫码...",await ZXingBrowser.BrowserQRCodeReader.wasmBindingsReady;const e=(await navigator.mediaDevices.enumerateDevices()).find(n=>n.kind==="videoinput");if(!e){C.value="❌ 没有找到摄像头";return}try{for($=await navigator.mediaDevices.getUserMedia({video:{deviceId:e.deviceId,facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}}),_.value.srcObject=$,await new Promise(n=>{const r=()=>{_.value.removeEventListener("canplay",r),n()};_.value.addEventListener("canplay",r)}),U||(U=new ZXingBrowser.BrowserMultiFormatReader);;){try{const n=await U.decodeOnceFromVideoElement(_.value);if(n){const r=n.getText();n.value="✅ 扫码成功："+r,p.value.id=r,V();break}}catch{}await new Promise(n=>setTimeout(n,300))}}catch(n){C.value="❌ 摄像头启动失败："+n}};return ye(oe),ge(async()=>{await V()}),(t,e)=>{const n=v("el-button"),r=v("el-tag"),D=v("el-input"),L=v("el-table-column"),A=v("el-table"),P=v("el-card"),X=v("el-form-item"),de=v("el-input-number"),re=v("el-form"),Z=v("el-dialog");return w(),I("div",ce,[o("div",ke,[a(n,{type:"primary",onClick:le},{default:i(()=>e[8]||(e[8]=[s("返回货架详情")])),_:1,__:[8]})]),o("h2",be,u(H(S))+" - "+u(te(H(f)))+" 区域",1),o("div",Ce,[a(n,{type:"success",onClick:e[0]||(e[0]=l=>E("good"))},{default:i(()=>e[9]||(e[9]=[s("添加好货")])),_:1,__:[9]}),a(n,{type:"warning",onClick:e[1]||(e[1]=l=>E("bad"))},{default:i(()=>e[10]||(e[10]=[s("添加坏货")])),_:1,__:[10]})]),e[36]||(e[36]=o("h3",null,"好货列表",-1)),a(P,{style:{"margin-bottom":"10px",padding:"0px"}},{default:i(()=>[a(A,{data:B.value,style:{width:"100%"},size:"small",border:""},{default:i(()=>[a(L,{label:"货物信息"},{default:i(l=>[o("div",$e,[o("div",Ve,[e[11]||(e[11]=o("strong",null,"编号:",-1)),s(" "+u(l.row.id),1)]),o("div",ze,[e[12]||(e[12]=o("strong",null,"数量:",-1)),s(" "+u(l.row.count),1)])]),o("div",Ie,[o("div",Ne,[e[13]||(e[13]=o("strong",null,"名称:",-1)),s(" "+u(N(l.row.id)[0]||"无"),1)]),o("div",Se,[a(n,{size:"small",text:"",onClick:d=>j(l.row)},{default:i(()=>[s(u(l.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),l.row._expanded?(w(),I("div",Be,[e[20]||(e[20]=o("div",null,[o("strong",null,"标签:")],-1)),o("div",Ue,[(w(!0),I(Y,null,G(N(l.row.id),(d,z)=>(w(),W(r,{key:z,closable:"",onClose:ue=>K(l.row.id,z),style:{margin:"2px"}},{default:i(()=>[s(u(d),1)]),_:2},1032,["onClose"]))),128)),a(D,{modelValue:c[l.row.id],"onUpdate:modelValue":d=>c[l.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:ee(d=>M(l.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[21]||(e[21]=o("div",{style:{"margin-top":"5px"}},[o("strong",null,"操作:")],-1)),o("div",De,[a(n,{size:"small",type:"primary",onClick:d=>g("good",l.$index,1)},{default:i(()=>e[14]||(e[14]=[s("+1")])),_:2,__:[14]},1032,["onClick"]),a(n,{size:"small",type:"primary",onClick:d=>g("good",l.$index,10)},{default:i(()=>e[15]||(e[15]=[s("+10")])),_:2,__:[15]},1032,["onClick"]),a(n,{size:"small",type:"danger",onClick:d=>J("good",l.$index),style:{"margin-left":"auto"}},{default:i(()=>e[16]||(e[16]=[s(" 删除 ")])),_:2,__:[16]},1032,["onClick"])]),o("div",Oe,[a(n,{size:"small",type:"primary",onClick:d=>g("good",l.$index,-1)},{default:i(()=>e[17]||(e[17]=[s("-1")])),_:2,__:[17]},1032,["onClick"]),a(n,{size:"small",type:"primary",onClick:d=>g("good",l.$index,-10)},{default:i(()=>e[18]||(e[18]=[s("-10")])),_:2,__:[18]},1032,["onClick"])]),o("div",Re,[a(n,{size:"small",type:"primary",onClick:d=>ae("good",l.$index)},{default:i(()=>e[19]||(e[19]=[s("查询所有位置")])),_:2,__:[19]},1032,["onClick"])])])):Q("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),e[37]||(e[37]=o("h3",null,"坏货列表",-1)),a(P,{style:{"margin-bottom":"10px",padding:"0px"}},{default:i(()=>[a(A,{data:h.value,style:{width:"100%"},size:"small",border:""},{default:i(()=>[a(L,{label:"货物信息"},{default:i(l=>[o("div",Te,[o("div",he,[e[22]||(e[22]=o("strong",null,"编号:",-1)),s(" "+u(l.row.id),1)]),o("div",je,[e[23]||(e[23]=o("strong",null,"数量:",-1)),s(" "+u(l.row.count),1)])]),o("div",Ee,[o("div",Je,[e[24]||(e[24]=o("strong",null,"名称:",-1)),s(" "+u(N(l.row.id)[0]||"无"),1)]),o("div",Me,[a(n,{size:"small",text:"",onClick:d=>j(l.row)},{default:i(()=>[s(u(l.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),l.row._expanded?(w(),I("div",Ke,[e[30]||(e[30]=o("div",null,[o("strong",null,"标签:")],-1)),o("div",Fe,[(w(!0),I(Y,null,G(N(l.row.id),(d,z)=>(w(),W(r,{key:z,closable:"",onClose:ue=>K(l.row.id,z),style:{margin:"2px"}},{default:i(()=>[s(u(d),1)]),_:2},1032,["onClose"]))),128)),a(D,{modelValue:c[l.row.id],"onUpdate:modelValue":d=>c[l.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:ee(d=>M(l.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[31]||(e[31]=o("div",{style:{"margin-top":"5px"}},[o("strong",null,"操作:")],-1)),o("div",Le,[a(n,{size:"small",type:"primary",onClick:d=>g("bad",l.$index,1)},{default:i(()=>e[25]||(e[25]=[s("+1")])),_:2,__:[25]},1032,["onClick"]),a(n,{size:"small",type:"primary",onClick:d=>g("bad",l.$index,10)},{default:i(()=>e[26]||(e[26]=[s("+10")])),_:2,__:[26]},1032,["onClick"]),a(n,{size:"small",type:"danger",onClick:d=>J("bad",l.$index),style:{"margin-left":"auto"}},{default:i(()=>e[27]||(e[27]=[s(" 删除 ")])),_:2,__:[27]},1032,["onClick"])]),o("div",Ae,[a(n,{size:"small",type:"primary",onClick:d=>g("bad",l.$index,-1)},{default:i(()=>e[28]||(e[28]=[s("-1")])),_:2,__:[28]},1032,["onClick"]),a(n,{size:"small",type:"primary",onClick:d=>g("bad",l.$index,-10)},{default:i(()=>e[29]||(e[29]=[s("-10")])),_:2,__:[29]},1032,["onClick"])])])):Q("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),a(Z,{title:p.value.type==="bad"?"添加坏货":"添加好货",modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=l=>k.value=l),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0},{footer:i(()=>[a(n,{onClick:e[5]||(e[5]=l=>k.value=!1)},{default:i(()=>e[33]||(e[33]=[s("取消")])),_:1,__:[33]}),a(n,{type:"primary",onClick:ne},{default:i(()=>e[34]||(e[34]=[s("确定")])),_:1,__:[34]})]),default:i(()=>[o("div",Pe,[a(re,{"label-position":"top","label-width":"80px"},{default:i(()=>[a(X,{label:"货物ID"},{default:i(()=>[a(D,{modelValue:p.value.id,"onUpdate:modelValue":e[2]||(e[2]=l=>p.value.id=l)},null,8,["modelValue"]),a(n,{type:"primary",plain:"",size:"small",style:{"margin-top":"5px"},onClick:e[3]||(e[3]=l=>b.value=!0)},{default:i(()=>e[32]||(e[32]=[s("扫码输入")])),_:1,__:[32]})]),_:1}),a(X,{label:"数量"},{default:i(()=>[a(de,{modelValue:p.value.count,"onUpdate:modelValue":e[4]||(e[4]=l=>p.value.count=l),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["title","modelValue"]),a(Z,{title:"扫码输入",modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=l=>b.value=l),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0,onClose:V},{footer:i(()=>[a(n,{onClick:V},{default:i(()=>e[35]||(e[35]=[s("取消")])),_:1,__:[35]})]),default:i(()=>[o("video",{ref_key:"videoRef",ref:_,autoplay:"",muted:"",playsinline:"",style:{width:"100%","max-height":"260px",border:"1px solid #ccc"}},null,512),o("div",Xe,u(C.value),1)]),_:1},8,["modelValue"])])}}},Qe=pe(Ze,[["__scopeId","data-v-2501ebb8"]]);export{Qe as default};
