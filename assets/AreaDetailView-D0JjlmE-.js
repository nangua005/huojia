import{_ as te,r as C,w as E,o as pe,c as M,a as k,b as a,d as l,t as y,e as n,f as s,g as _,n as me,u as ve,h as Q,i as fe,j as ye,k as N,l as Y,m as ge,p as _e,q as G,F as W,s as h,v as ee,x as j,E as U}from"./index-D6fYg6Lg.js";const xe={class:"scan-container"},ce={style:{"margin-top":"10px","word-break":"break-all"}},we={__name:"ScanDialog",props:{modelValue:Boolean},emits:["update:modelValue","success"],setup(J,{emit:B}){const I=J,$=B,m=C(I.modelValue);E(()=>I.modelValue,p=>m.value=p),E(m,p=>$("update:modelValue",p));const r=C(null),x=C("等待扫码...");let V=null,u=null;const z=async()=>{try{u&&u.getTracks().forEach(p=>p.stop())}catch(p){console.warn("关闭摄像头失败：",p)}u=null,r.value&&(r.value.pause(),r.value.srcObject=null)},T=async()=>{x.value="等待扫码...",await me(),await ZXingBrowser.BrowserQRCodeReader.wasmBindingsReady;const f=(await navigator.mediaDevices.enumerateDevices()).find(v=>v.kind==="videoinput");if(!f){x.value="❌ 没有找到摄像头";return}try{for(u=await navigator.mediaDevices.getUserMedia({video:{deviceId:f.deviceId,facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),r.value.srcObject=u,await new Promise(v=>{const c=()=>{r.value.removeEventListener("canplay",c),v()};r.value.addEventListener("canplay",c)}),V||(V=new ZXingBrowser.BrowserMultiFormatReader);m.value;){try{const v=await V.decodeOnceFromVideoElement(r.value);if(v){const c=v.getText();x.value="✅ 扫码成功："+c,$("success",c),setTimeout(()=>{g()},1500);break}}catch{}await new Promise(v=>setTimeout(v,60))}}catch(v){x.value="❌ 摄像头启动失败："+v}},g=async()=>{m.value=!1,await z()};return E(m,p=>{p&&T()}),pe(z),(p,f)=>{const v=_("el-button"),c=_("el-dialog");return k(),M(c,{title:"扫码输入",modelValue:m.value,"onUpdate:modelValue":f[0]||(f[0]=O=>m.value=O),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0,onClose:g},{footer:a(()=>[n(v,{onClick:g},{default:a(()=>f[3]||(f[3]=[s("取消")])),_:1,__:[3]})]),default:a(()=>[l("div",xe,[l("video",{ref_key:"videoRef",ref:r,autoplay:"",muted:"",playsinline:"",class:"scan-video"},null,512),f[1]||(f[1]=l("div",{class:"scan-frame"},[l("div",{class:"scan-line"})],-1)),f[2]||(f[2]=l("div",{class:"scan-tip"},"请将条码放入红框中进行扫描",-1))]),l("div",ce,y(x.value),1)]),_:1},8,["modelValue"])}}},be=te(we,[["__scopeId","data-v-9a954ae2"]]),ke={style:{padding:"20px"}},Ce={style:{"margin-bottom":"20px"}},Ve={style:{"margin-bottom":"10px"}},$e={style:{"text-align":"right","margin-bottom":"20px"}},ze={style:{display:"flex","justify-content":"space-between"}},Ie={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Se={style:{flex:"1 1 20%","text-align":"right"}},Ne={style:{display:"flex","justify-content":"space-between"}},Be={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Te={style:{flex:"1 1 20%","text-align":"right"}},De={key:0,style:{"margin-top":"5px"}},Ue={style:{"margin-top":"5px"}},Oe={style:{display:"flex","align-items":"center",gap:"5px"}},Re={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Ee={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},je={style:{display:"flex","justify-content":"space-between"}},Me={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Je={style:{flex:"1 1 20%","text-align":"right"}},Fe={style:{display:"flex","justify-content":"space-between"}},Ke={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Le={style:{flex:"1 1 20%","text-align":"right"}},Ae={key:0,style:{"margin-top":"5px"}},Pe={style:{"margin-top":"5px"}},Xe={style:{display:"flex","align-items":"center",gap:"5px"}},Ze={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},qe={style:{padding:"10px",maxHeight:"60vh",overflowY:"auto"}},He={__name:"AreaDetailView",setup(J){const B=ve(),I=_e(),$=B.params.shelfNo,m=B.params.area,r=C(null),x=C(!1),V=C(!1),u=C({id:"",count:1,type:"good"}),z=Q(()=>(r.value?.areas[m]||[]).filter(o=>o.type==="good")),T=Q(()=>(r.value?.areas[m]||[]).filter(o=>o.type==="bad")),g=C({}),p=fe({}),f=o=>{u.value.id=o},v=o=>({left:"左侧",center:"中间",right:"右侧"})[o]||o,c=()=>I.push(`/shelf/${$}`),O=async()=>{const o=await ge($);if(o){r.value=o;for(const e of o.areas[m])e._expanded=!1}},F=o=>o._expanded=!o._expanded,K=o=>{u.value={id:"",count:1,type:o},x.value=!0},le=async()=>{const o={id:u.value.id,count:u.value.count,name:"",type:u.value.type,_expanded:!1};r.value.areas[m]||(r.value.areas[m]=[]),r.value.areas[m].push(o),g.value[o.id]||(g.value[o.id]=[]),await j(JSON.parse(JSON.stringify(r.value))),ne(),x.value=!1},L=async o=>{r.value.areas[m].splice(o,1),await j(JSON.parse(JSON.stringify(r.value)))},b=(o,e,i)=>{const w=o==="good"?z.value:T.value;e<0||e>=w.length||(w[e].count+=i,w[e].count<1&&(w[e].count=1),j(JSON.parse(JSON.stringify(r.value))))},oe=(o,e)=>{const i=z.value;if(e<0||e>=i.length)return;const w=i[e].id;I.push(`/product?id=${encodeURIComponent(w)}`)},D=o=>g.value[o]||[],A=o=>{const e=(p[o]||"").trim();e&&(g.value[o]||(g.value[o]=[]),g.value[o].includes(e)||g.value[o].push(e),p[o]="")},P=(o,e)=>{g.value[o]?.splice(e,1)},ne=()=>{u.value={id:"",count:1,type:"good"}},ae=async()=>{try{await navigator.clipboard.writeText(u.value.id),U.success("已复制到剪贴板")}catch{U.error("复制失败")}},se=async()=>{try{const o=await navigator.clipboard.readText();u.value.id=o,U.success("已粘贴剪贴板内容")}catch{U.error("粘贴失败")}};return ye(O),(o,e)=>{const i=_("el-button"),w=_("el-tag"),R=_("el-input"),X=_("el-table-column"),Z=_("el-table"),q=_("el-card"),H=_("el-form-item"),ie=_("el-input-number"),de=_("el-form"),re=_("el-dialog");return k(),N("div",ke,[l("div",Ce,[n(i,{type:"primary",onClick:c},{default:a(()=>e[8]||(e[8]=[s("返回货架详情")])),_:1,__:[8]})]),l("h2",Ve,y(Y($))+" - "+y(v(Y(m)))+" 区域",1),l("div",$e,[n(i,{type:"success",onClick:e[0]||(e[0]=t=>K("good"))},{default:a(()=>e[9]||(e[9]=[s("添加好货")])),_:1,__:[9]}),n(i,{type:"warning",onClick:e[1]||(e[1]=t=>K("bad"))},{default:a(()=>e[10]||(e[10]=[s("添加坏货")])),_:1,__:[10]})]),e[37]||(e[37]=l("h3",null,"好货列表",-1)),n(q,{style:{"margin-bottom":"10px",padding:"0px"}},{default:a(()=>[n(Z,{data:z.value,style:{width:"100%"},size:"small",border:""},{default:a(()=>[n(X,{label:"货物信息"},{default:a(t=>[l("div",ze,[l("div",Ie,[e[11]||(e[11]=l("strong",null,"编号:",-1)),s(" "+y(t.row.id),1)]),l("div",Se,[e[12]||(e[12]=l("strong",null,"数量:",-1)),s(" "+y(t.row.count),1)])]),l("div",Ne,[l("div",Be,[e[13]||(e[13]=l("strong",null,"名称:",-1)),s(" "+y(D(t.row.id)[0]||"无"),1)]),l("div",Te,[n(i,{size:"small",text:"",onClick:d=>F(t.row)},{default:a(()=>[s(y(t.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),t.row._expanded?(k(),N("div",De,[e[20]||(e[20]=l("div",null,[l("strong",null,"标签:")],-1)),l("div",Ue,[(k(!0),N(W,null,h(D(t.row.id),(d,S)=>(k(),M(w,{key:S,closable:"",onClose:ue=>P(t.row.id,S),style:{margin:"2px"}},{default:a(()=>[s(y(d),1)]),_:2},1032,["onClose"]))),128)),n(R,{modelValue:p[t.row.id],"onUpdate:modelValue":d=>p[t.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:ee(d=>A(t.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[21]||(e[21]=l("div",{style:{"margin-top":"5px"}},[l("strong",null,"操作:")],-1)),l("div",Oe,[n(i,{size:"small",type:"primary",onClick:d=>b("good",t.$index,1)},{default:a(()=>e[14]||(e[14]=[s("+1")])),_:2,__:[14]},1032,["onClick"]),n(i,{size:"small",type:"primary",onClick:d=>b("good",t.$index,10)},{default:a(()=>e[15]||(e[15]=[s("+10")])),_:2,__:[15]},1032,["onClick"]),n(i,{size:"small",type:"danger",onClick:d=>L("good",t.$index),style:{"margin-left":"auto"}},{default:a(()=>e[16]||(e[16]=[s(" 删除 ")])),_:2,__:[16]},1032,["onClick"])]),l("div",Re,[n(i,{size:"small",type:"primary",onClick:d=>b("good",t.$index,-1)},{default:a(()=>e[17]||(e[17]=[s("-1")])),_:2,__:[17]},1032,["onClick"]),n(i,{size:"small",type:"primary",onClick:d=>b("good",t.$index,-10)},{default:a(()=>e[18]||(e[18]=[s("-10")])),_:2,__:[18]},1032,["onClick"])]),l("div",Ee,[n(i,{size:"small",type:"primary",onClick:d=>oe("good",t.$index)},{default:a(()=>e[19]||(e[19]=[s("查询所有位置")])),_:2,__:[19]},1032,["onClick"])])])):G("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),e[38]||(e[38]=l("h3",null,"坏货列表",-1)),n(q,{style:{"margin-bottom":"10px",padding:"0px"}},{default:a(()=>[n(Z,{data:T.value,style:{width:"100%"},size:"small",border:""},{default:a(()=>[n(X,{label:"货物信息"},{default:a(t=>[l("div",je,[l("div",Me,[e[22]||(e[22]=l("strong",null,"编号:",-1)),s(" "+y(t.row.id),1)]),l("div",Je,[e[23]||(e[23]=l("strong",null,"数量:",-1)),s(" "+y(t.row.count),1)])]),l("div",Fe,[l("div",Ke,[e[24]||(e[24]=l("strong",null,"名称:",-1)),s(" "+y(D(t.row.id)[0]||"无"),1)]),l("div",Le,[n(i,{size:"small",text:"",onClick:d=>F(t.row)},{default:a(()=>[s(y(t.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),t.row._expanded?(k(),N("div",Ae,[e[30]||(e[30]=l("div",null,[l("strong",null,"标签:")],-1)),l("div",Pe,[(k(!0),N(W,null,h(D(t.row.id),(d,S)=>(k(),M(w,{key:S,closable:"",onClose:ue=>P(t.row.id,S),style:{margin:"2px"}},{default:a(()=>[s(y(d),1)]),_:2},1032,["onClose"]))),128)),n(R,{modelValue:p[t.row.id],"onUpdate:modelValue":d=>p[t.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:ee(d=>A(t.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[31]||(e[31]=l("div",{style:{"margin-top":"5px"}},[l("strong",null,"操作:")],-1)),l("div",Xe,[n(i,{size:"small",type:"primary",onClick:d=>b("bad",t.$index,1)},{default:a(()=>e[25]||(e[25]=[s("+1")])),_:2,__:[25]},1032,["onClick"]),n(i,{size:"small",type:"primary",onClick:d=>b("bad",t.$index,10)},{default:a(()=>e[26]||(e[26]=[s("+10")])),_:2,__:[26]},1032,["onClick"]),n(i,{size:"small",type:"danger",onClick:d=>L("bad",t.$index),style:{"margin-left":"auto"}},{default:a(()=>e[27]||(e[27]=[s(" 删除 ")])),_:2,__:[27]},1032,["onClick"])]),l("div",Ze,[n(i,{size:"small",type:"primary",onClick:d=>b("bad",t.$index,-1)},{default:a(()=>e[28]||(e[28]=[s("-1")])),_:2,__:[28]},1032,["onClick"]),n(i,{size:"small",type:"primary",onClick:d=>b("bad",t.$index,-10)},{default:a(()=>e[29]||(e[29]=[s("-10")])),_:2,__:[29]},1032,["onClick"])])])):G("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),n(re,{title:u.value.type==="bad"?"添加坏货":"添加好货",modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=t=>x.value=t),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0},{footer:a(()=>[n(i,{onClick:e[5]||(e[5]=t=>x.value=!1)},{default:a(()=>e[35]||(e[35]=[s("取消")])),_:1,__:[35]}),n(i,{type:"primary",onClick:le},{default:a(()=>e[36]||(e[36]=[s("确定")])),_:1,__:[36]})]),default:a(()=>[l("div",qe,[n(de,{"label-position":"top","label-width":"80px"},{default:a(()=>[n(H,{label:"货物ID"},{default:a(()=>[n(R,{modelValue:u.value.id,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value.id=t)},null,8,["modelValue"]),n(i,{type:"primary",plain:"",size:"small",style:{"margin-top":"5px"},onClick:e[3]||(e[3]=t=>V.value=!0)},{default:a(()=>e[32]||(e[32]=[s("扫码输入")])),_:1,__:[32]}),n(i,{type:"primary",plain:"",size:"small",onClick:ae},{default:a(()=>e[33]||(e[33]=[s("复制")])),_:1,__:[33]}),n(i,{type:"primary",plain:"",size:"small",onClick:se},{default:a(()=>e[34]||(e[34]=[s("粘贴")])),_:1,__:[34]})]),_:1}),n(H,{label:"数量"},{default:a(()=>[n(ie,{modelValue:u.value.count,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.count=t),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["title","modelValue"]),n(be,{modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=t=>V.value=t),onSuccess:f},null,8,["modelValue"])])}}},Ye=te(He,[["__scopeId","data-v-2f4fc46a"]]);export{Ye as default};
