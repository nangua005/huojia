import{u as de,r as I,c as P,a as re,w as ue,o as me,b as pe,d as N,e as o,f as n,g as a,h as v,t as r,i as h,j as fe,k as ye,l as w,m as i,n as Q,F as L,p as X,q as Y,s as Z,v as O,x as ve}from"./index-CeGT6tiY.js";import{H as ge,a as u}from"./html5-qrcode-scanner-BpEXIfcw.js";const _e={style:{padding:"20px"}},xe={style:{"margin-bottom":"20px"}},we={style:{"margin-bottom":"10px"}},Ce={style:{"text-align":"right","margin-bottom":"20px"}},ke={style:{display:"flex","justify-content":"space-between"}},be={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},$e={style:{flex:"1 1 20%","text-align":"right"}},Ve={style:{display:"flex","justify-content":"space-between"}},ce={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},ze={style:{flex:"1 1 20%","text-align":"right"}},Ie={key:0,style:{"margin-top":"5px"}},Ne={style:{"margin-top":"5px"}},De={style:{display:"flex","align-items":"center",gap:"5px"}},Se={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Ee={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Ue={style:{display:"flex","justify-content":"space-between"}},Oe={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Te={style:{flex:"1 1 20%","text-align":"right"}},Ae={style:{display:"flex","justify-content":"space-between"}},Be={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Fe={style:{flex:"1 1 20%","text-align":"right"}},Je={key:0,style:{"margin-top":"5px"}},Me={style:{"margin-top":"5px"}},je={style:{display:"flex","align-items":"center",gap:"5px"}},qe={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Ke={style:{padding:"10px",maxHeight:"60vh",overflowY:"auto"}},he={__name:"AreaDetailView",setup(Re){const T=de(),A=ye(),E=T.params.shelfNo,g=T.params.area,y=I(null),k=I(!1),b=I(!1);let m=null;const p=I({id:"",count:1,type:"good"}),U=P(()=>(y.value?.areas[g]||[]).filter(l=>l.type==="good")),B=P(()=>(y.value?.areas[g]||[]).filter(l=>l.type==="bad")),_=I({}),C=re({}),G=l=>({left:"左侧",center:"中间",right:"右侧"})[l]||l,W=()=>A.push(`/shelf/${E}`),ee=async()=>{const l=await fe(E);if(l){y.value=l;for(const e of l.areas[g])e._expanded=!1}},F=l=>l._expanded=!l._expanded,J=l=>{p.value={id:"",count:1,type:l},k.value=!0},te=async()=>{const l={id:p.value.id,count:p.value.count,name:"",type:p.value.type,_expanded:!1};y.value.areas[g]||(y.value.areas[g]=[]),y.value.areas[g].push(l),_.value[l.id]||(_.value[l.id]=[]),await O(JSON.parse(JSON.stringify(y.value))),oe(),k.value=!1},M=async l=>{y.value.areas[g].splice(l,1),await O(JSON.parse(JSON.stringify(y.value)))},x=(l,e,s)=>{const f=l==="good"?U.value:B.value;e<0||e>=f.length||(f[e].count+=s,f[e].count<1&&(f[e].count=1),O(JSON.parse(JSON.stringify(y.value))))},le=(l,e)=>{const s=U.value;if(e<0||e>=s.length)return;const f=s[e].id;A.push(`/product?id=${encodeURIComponent(f)}`)},D=l=>_.value[l]||[],j=l=>{const e=(C[l]||"").trim();e&&(_.value[l]||(_.value[l]=[]),_.value[l].includes(e)||_.value[l].push(e),C[l]="")},q=(l,e)=>{_.value[l]?.splice(e,1)},oe=()=>{p.value={id:"",count:1,type:"good"}};ue(b,async l=>{if(l){await ve();try{await ne("html5qr-code"),m||(m=new ge("html5qr-code")),await m.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:150},formatsToSupport:[u.EAN_13,u.CODE_128,u.EAN_8,u.UPC_A,u.UPC_E,u.CODE_39,u.CODE_93,u.ITF,u.DATA_MATRIX,u.AZTEC,u.QR_CODE,u.PDF_417]},e=>{p.value.id=e,S()},e=>{})}catch(e){alert("扫码初始化失败："+e.message)}}else S()});function ne(l,e=1e3){return new Promise((s,f)=>{const $=Date.now(),V=setInterval(()=>{const c=document.getElementById(l);c?(clearInterval(V),s(c)):Date.now()-$>e&&(clearInterval(V),f(new Error("扫码容器加载超时")))},50)})}const S=async()=>{if(b.value=!1,m)try{await m.stop(),await m.clear(),m=null}catch(l){console.warn("停止扫码失败：",l)}};return me(ee),pe(async()=>{if(m&&m.getState()===2){try{await m.stop()}catch{}m.clear()}}),(l,e)=>{const s=v("el-button"),f=v("el-tag"),$=v("el-input"),V=v("el-table-column"),c=v("el-table"),K=v("el-card"),R=v("el-form-item"),ae=v("el-input-number"),ie=v("el-form"),H=v("el-dialog");return w(),N("div",_e,[o("div",xe,[n(s,{type:"primary",onClick:W},{default:a(()=>e[8]||(e[8]=[i("返回货架详情")])),_:1,__:[8]})]),o("h2",we,r(h(E))+" - "+r(G(h(g)))+" 区域",1),o("div",Ce,[n(s,{type:"success",onClick:e[0]||(e[0]=t=>J("good"))},{default:a(()=>e[9]||(e[9]=[i("添加好货")])),_:1,__:[9]}),n(s,{type:"warning",onClick:e[1]||(e[1]=t=>J("bad"))},{default:a(()=>e[10]||(e[10]=[i("添加坏货")])),_:1,__:[10]})]),e[37]||(e[37]=o("h3",null,"好货列表",-1)),n(K,{style:{"margin-bottom":"10px",padding:"0px"}},{default:a(()=>[n(c,{data:U.value,style:{width:"100%"},size:"small",border:""},{default:a(()=>[n(V,{label:"货物信息"},{default:a(t=>[o("div",ke,[o("div",be,[e[11]||(e[11]=o("strong",null,"编号:",-1)),i(" "+r(t.row.id),1)]),o("div",$e,[e[12]||(e[12]=o("strong",null,"数量:",-1)),i(" "+r(t.row.count),1)])]),o("div",Ve,[o("div",ce,[e[13]||(e[13]=o("strong",null,"名称:",-1)),i(" "+r(D(t.row.id)[0]||"无"),1)]),o("div",ze,[n(s,{size:"small",text:"",onClick:d=>F(t.row)},{default:a(()=>[i(r(t.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),t.row._expanded?(w(),N("div",Ie,[e[20]||(e[20]=o("div",null,[o("strong",null,"标签:")],-1)),o("div",Ne,[(w(!0),N(L,null,X(D(t.row.id),(d,z)=>(w(),Y(f,{key:z,closable:"",onClose:se=>q(t.row.id,z),style:{margin:"2px"}},{default:a(()=>[i(r(d),1)]),_:2},1032,["onClose"]))),128)),n($,{modelValue:C[t.row.id],"onUpdate:modelValue":d=>C[t.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:Z(d=>j(t.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[21]||(e[21]=o("div",{style:{"margin-top":"5px"}},[o("strong",null,"操作:")],-1)),o("div",De,[n(s,{size:"small",type:"primary",onClick:d=>x("good",t.$index,1)},{default:a(()=>e[14]||(e[14]=[i("+1")])),_:2,__:[14]},1032,["onClick"]),n(s,{size:"small",type:"primary",onClick:d=>x("good",t.$index,10)},{default:a(()=>e[15]||(e[15]=[i("+10")])),_:2,__:[15]},1032,["onClick"]),n(s,{size:"small",type:"danger",onClick:d=>M("good",t.$index),style:{"margin-left":"auto"}},{default:a(()=>e[16]||(e[16]=[i(" 删除 ")])),_:2,__:[16]},1032,["onClick"])]),o("div",Se,[n(s,{size:"small",type:"primary",onClick:d=>x("good",t.$index,-1)},{default:a(()=>e[17]||(e[17]=[i("-1")])),_:2,__:[17]},1032,["onClick"]),n(s,{size:"small",type:"primary",onClick:d=>x("good",t.$index,-10)},{default:a(()=>e[18]||(e[18]=[i("-10")])),_:2,__:[18]},1032,["onClick"])]),o("div",Ee,[n(s,{size:"small",type:"primary",onClick:d=>le("good",t.$index)},{default:a(()=>e[19]||(e[19]=[i("查询所有位置")])),_:2,__:[19]},1032,["onClick"])])])):Q("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),e[38]||(e[38]=o("h3",null,"坏货列表",-1)),n(K,{style:{"margin-bottom":"10px",padding:"0px"}},{default:a(()=>[n(c,{data:B.value,style:{width:"100%"},size:"small",border:""},{default:a(()=>[n(V,{label:"货物信息"},{default:a(t=>[o("div",Ue,[o("div",Oe,[e[22]||(e[22]=o("strong",null,"编号:",-1)),i(" "+r(t.row.id),1)]),o("div",Te,[e[23]||(e[23]=o("strong",null,"数量:",-1)),i(" "+r(t.row.count),1)])]),o("div",Ae,[o("div",Be,[e[24]||(e[24]=o("strong",null,"名称:",-1)),i(" "+r(D(t.row.id)[0]||"无"),1)]),o("div",Fe,[n(s,{size:"small",text:"",onClick:d=>F(t.row)},{default:a(()=>[i(r(t.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),t.row._expanded?(w(),N("div",Je,[e[30]||(e[30]=o("div",null,[o("strong",null,"标签:")],-1)),o("div",Me,[(w(!0),N(L,null,X(D(t.row.id),(d,z)=>(w(),Y(f,{key:z,closable:"",onClose:se=>q(t.row.id,z),style:{margin:"2px"}},{default:a(()=>[i(r(d),1)]),_:2},1032,["onClose"]))),128)),n($,{modelValue:C[t.row.id],"onUpdate:modelValue":d=>C[t.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:Z(d=>j(t.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[31]||(e[31]=o("div",{style:{"margin-top":"5px"}},[o("strong",null,"操作:")],-1)),o("div",je,[n(s,{size:"small",type:"primary",onClick:d=>x("bad",t.$index,1)},{default:a(()=>e[25]||(e[25]=[i("+1")])),_:2,__:[25]},1032,["onClick"]),n(s,{size:"small",type:"primary",onClick:d=>x("bad",t.$index,10)},{default:a(()=>e[26]||(e[26]=[i("+10")])),_:2,__:[26]},1032,["onClick"]),n(s,{size:"small",type:"danger",onClick:d=>M("bad",t.$index),style:{"margin-left":"auto"}},{default:a(()=>e[27]||(e[27]=[i(" 删除 ")])),_:2,__:[27]},1032,["onClick"])]),o("div",qe,[n(s,{size:"small",type:"primary",onClick:d=>x("bad",t.$index,-1)},{default:a(()=>e[28]||(e[28]=[i("-1")])),_:2,__:[28]},1032,["onClick"]),n(s,{size:"small",type:"primary",onClick:d=>x("bad",t.$index,-10)},{default:a(()=>e[29]||(e[29]=[i("-10")])),_:2,__:[29]},1032,["onClick"])])])):Q("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),n(H,{title:p.value.type==="bad"?"添加坏货":"添加好货",modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=t=>k.value=t),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0},{footer:a(()=>[n(s,{onClick:e[5]||(e[5]=t=>k.value=!1)},{default:a(()=>e[33]||(e[33]=[i("取消")])),_:1,__:[33]}),n(s,{type:"primary",onClick:te},{default:a(()=>e[34]||(e[34]=[i("确定")])),_:1,__:[34]})]),default:a(()=>[o("div",Ke,[n(ie,{"label-position":"top","label-width":"80px"},{default:a(()=>[n(R,{label:"货物ID"},{default:a(()=>[n($,{modelValue:p.value.id,"onUpdate:modelValue":e[2]||(e[2]=t=>p.value.id=t)},null,8,["modelValue"]),n(s,{type:"primary",plain:"",size:"small",style:{"margin-top":"5px"},onClick:e[3]||(e[3]=t=>b.value=!0)},{default:a(()=>e[32]||(e[32]=[i("扫码输入")])),_:1,__:[32]})]),_:1}),n(R,{label:"数量"},{default:a(()=>[n(ae,{modelValue:p.value.count,"onUpdate:modelValue":e[4]||(e[4]=t=>p.value.count=t),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["title","modelValue"]),n(H,{title:"扫码输入",modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=t=>b.value=t),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0,onClose:S},{footer:a(()=>[n(s,{onClick:S},{default:a(()=>e[35]||(e[35]=[i("取消")])),_:1,__:[35]})]),default:a(()=>[e[36]||(e[36]=o("div",{id:"html5qr-code",style:{width:"100%","max-height":"260px"}},null,-1))]),_:1,__:[36]},8,["modelValue"])])}}};export{he as default};
