import{u as se,r as $,c as h,a as de,w as re,o as ue,b as pe,d as c,e as o,f as n,g as a,h as y,t as r,i as q,j as me,k as fe,l as w,m as i,n as P,F as Q,p as L,q as X,s as Y,v as U,x as ye}from"./index-B4k62l3f.js";import{H as ve,a as u}from"./html5-qrcode-scanner-CpmiswPQ.js";const _e={style:{padding:"20px"}},ge={style:{"margin-bottom":"20px"}},xe={style:{"margin-bottom":"10px"}},we={style:{"text-align":"right","margin-bottom":"20px"}},Ce={style:{display:"flex","justify-content":"space-between"}},ke={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},be={style:{flex:"1 1 20%","text-align":"right"}},$e={style:{display:"flex","justify-content":"space-between"}},ce={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Ve={style:{flex:"1 1 20%","text-align":"right"}},ze={key:0,style:{"margin-top":"5px"}},Ne={style:{"margin-top":"5px"}},Ie={style:{display:"flex","align-items":"center",gap:"5px"}},Se={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},De={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Ue={style:{display:"flex","justify-content":"space-between"}},Ee={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Oe={style:{flex:"1 1 20%","text-align":"right"}},Te={style:{display:"flex","justify-content":"space-between"}},Ae={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Be={style:{flex:"1 1 20%","text-align":"right"}},Je={key:0,style:{"margin-top":"5px"}},Re={style:{"margin-top":"5px"}},je={style:{display:"flex","align-items":"center",gap:"5px"}},Fe={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Ke={style:{padding:"10px",maxHeight:"60vh",overflowY:"auto"}},Me="html5qr-code",Pe={__name:"AreaDetailView",setup(He){const E=se(),O=fe(),z=E.params.shelfNo,_=E.params.area,f=$(null),k=$(!1),N=$(!1);let p=null;const m=$({id:"",count:1,type:"good"}),I=h(()=>(f.value?.areas[_]||[]).filter(l=>l.type==="good")),T=h(()=>(f.value?.areas[_]||[]).filter(l=>l.type==="bad")),g=$({}),C=de({}),Z=l=>({left:"左侧",center:"中间",right:"右侧"})[l]||l,G=()=>O.push(`/shelf/${z}`),W=async()=>{const l=await me(z);if(l){f.value=l;for(const e of l.areas[_])e._expanded=!1}},A=l=>l._expanded=!l._expanded,B=l=>{m.value={id:"",count:1,type:l},k.value=!0},ee=async()=>{const l={id:m.value.id,count:m.value.count,name:"",type:m.value.type,_expanded:!1};f.value.areas[_]||(f.value.areas[_]=[]),f.value.areas[_].push(l),g.value[l.id]||(g.value[l.id]=[]),await U(JSON.parse(JSON.stringify(f.value))),le(),k.value=!1},J=async l=>{f.value.areas[_].splice(l,1),await U(JSON.parse(JSON.stringify(f.value)))},x=(l,e,s)=>{const v=l==="good"?I.value:T.value;e<0||e>=v.length||(v[e].count+=s,v[e].count<1&&(v[e].count=1),U(JSON.parse(JSON.stringify(f.value))))},te=(l,e)=>{const s=I.value;if(e<0||e>=s.length)return;const v=s[e].id;O.push(`/product?id=${encodeURIComponent(v)}`)},V=l=>g.value[l]||[],R=l=>{const e=(C[l]||"").trim();e&&(g.value[l]||(g.value[l]=[]),g.value[l].includes(e)||g.value[l].push(e),C[l]="")},j=(l,e)=>{g.value[l]?.splice(e,1)},le=()=>{m.value={id:"",count:1,type:"good"}};re(N,async l=>{if(l){await ye(),p||(p=new ve(Me));try{await p.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:150},aspectRatio:1.6,formatsToSupport:[u.EAN_13,u.CODE_128,u.EAN_8,u.UPC_A,u.UPC_E,u.CODE_39,u.CODE_93,u.ITF,u.DATA_MATRIX,u.AZTEC,u.QR_CODE,u.PDF_417]},e=>{m.value.id=e,S()},()=>{})}catch(e){alert("扫码失败："+e),S()}}else S()});const S=async()=>{if(N.value=!1,p)try{await p.stop(),await p.clear(),p=null}catch(l){console.warn("停止扫码失败：",l)}};return ue(W),pe(async()=>{if(p&&p.getState()===2){try{await p.stop()}catch{}p.clear()}}),(l,e)=>{const s=y("el-button"),v=y("el-tag"),D=y("el-input"),F=y("el-table-column"),K=y("el-table"),M=y("el-card"),H=y("el-form-item"),oe=y("el-input-number"),ne=y("el-form"),ae=y("el-dialog");return w(),c("div",_e,[o("div",ge,[n(s,{type:"primary",onClick:G},{default:a(()=>e[7]||(e[7]=[i("返回货架详情")])),_:1,__:[7]})]),o("h2",xe,r(q(z))+" - "+r(Z(q(_)))+" 区域",1),o("div",we,[n(s,{type:"success",onClick:e[0]||(e[0]=t=>B("good"))},{default:a(()=>e[8]||(e[8]=[i("添加好货")])),_:1,__:[8]}),n(s,{type:"warning",onClick:e[1]||(e[1]=t=>B("bad"))},{default:a(()=>e[9]||(e[9]=[i("添加坏货")])),_:1,__:[9]})]),e[34]||(e[34]=o("h3",null,"好货列表",-1)),n(M,{style:{"margin-bottom":"10px",padding:"0px"}},{default:a(()=>[n(K,{data:I.value,style:{width:"100%"},size:"small",border:""},{default:a(()=>[n(F,{label:"货物信息"},{default:a(t=>[o("div",Ce,[o("div",ke,[e[10]||(e[10]=o("strong",null,"编号:",-1)),i(" "+r(t.row.id),1)]),o("div",be,[e[11]||(e[11]=o("strong",null,"数量:",-1)),i(" "+r(t.row.count),1)])]),o("div",$e,[o("div",ce,[e[12]||(e[12]=o("strong",null,"名称:",-1)),i(" "+r(V(t.row.id)[0]||"无"),1)]),o("div",Ve,[n(s,{size:"small",text:"",onClick:d=>A(t.row)},{default:a(()=>[i(r(t.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),t.row._expanded?(w(),c("div",ze,[e[19]||(e[19]=o("div",null,[o("strong",null,"标签:")],-1)),o("div",Ne,[(w(!0),c(Q,null,L(V(t.row.id),(d,b)=>(w(),X(v,{key:b,closable:"",onClose:ie=>j(t.row.id,b),style:{margin:"2px"}},{default:a(()=>[i(r(d),1)]),_:2},1032,["onClose"]))),128)),n(D,{modelValue:C[t.row.id],"onUpdate:modelValue":d=>C[t.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:Y(d=>R(t.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[20]||(e[20]=o("div",{style:{"margin-top":"5px"}},[o("strong",null,"操作:")],-1)),o("div",Ie,[n(s,{size:"small",type:"primary",onClick:d=>x("good",t.$index,1)},{default:a(()=>e[13]||(e[13]=[i("+1")])),_:2,__:[13]},1032,["onClick"]),n(s,{size:"small",type:"primary",onClick:d=>x("good",t.$index,10)},{default:a(()=>e[14]||(e[14]=[i("+10")])),_:2,__:[14]},1032,["onClick"]),n(s,{size:"small",type:"danger",onClick:d=>J("good",t.$index),style:{"margin-left":"auto"}},{default:a(()=>e[15]||(e[15]=[i(" 删除 ")])),_:2,__:[15]},1032,["onClick"])]),o("div",Se,[n(s,{size:"small",type:"primary",onClick:d=>x("good",t.$index,-1)},{default:a(()=>e[16]||(e[16]=[i("-1")])),_:2,__:[16]},1032,["onClick"]),n(s,{size:"small",type:"primary",onClick:d=>x("good",t.$index,-10)},{default:a(()=>e[17]||(e[17]=[i("-10")])),_:2,__:[17]},1032,["onClick"])]),o("div",De,[n(s,{size:"small",type:"primary",onClick:d=>te("good",t.$index)},{default:a(()=>e[18]||(e[18]=[i("查询所有位置")])),_:2,__:[18]},1032,["onClick"])])])):P("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),e[35]||(e[35]=o("h3",null,"坏货列表",-1)),n(M,{style:{"margin-bottom":"10px",padding:"0px"}},{default:a(()=>[n(K,{data:T.value,style:{width:"100%"},size:"small",border:""},{default:a(()=>[n(F,{label:"货物信息"},{default:a(t=>[o("div",Ue,[o("div",Ee,[e[21]||(e[21]=o("strong",null,"编号:",-1)),i(" "+r(t.row.id),1)]),o("div",Oe,[e[22]||(e[22]=o("strong",null,"数量:",-1)),i(" "+r(t.row.count),1)])]),o("div",Te,[o("div",Ae,[e[23]||(e[23]=o("strong",null,"名称:",-1)),i(" "+r(V(t.row.id)[0]||"无"),1)]),o("div",Be,[n(s,{size:"small",text:"",onClick:d=>A(t.row)},{default:a(()=>[i(r(t.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),t.row._expanded?(w(),c("div",Je,[e[29]||(e[29]=o("div",null,[o("strong",null,"标签:")],-1)),o("div",Re,[(w(!0),c(Q,null,L(V(t.row.id),(d,b)=>(w(),X(v,{key:b,closable:"",onClose:ie=>j(t.row.id,b),style:{margin:"2px"}},{default:a(()=>[i(r(d),1)]),_:2},1032,["onClose"]))),128)),n(D,{modelValue:C[t.row.id],"onUpdate:modelValue":d=>C[t.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:Y(d=>R(t.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[30]||(e[30]=o("div",{style:{"margin-top":"5px"}},[o("strong",null,"操作:")],-1)),o("div",je,[n(s,{size:"small",type:"primary",onClick:d=>x("bad",t.$index,1)},{default:a(()=>e[24]||(e[24]=[i("+1")])),_:2,__:[24]},1032,["onClick"]),n(s,{size:"small",type:"primary",onClick:d=>x("bad",t.$index,10)},{default:a(()=>e[25]||(e[25]=[i("+10")])),_:2,__:[25]},1032,["onClick"]),n(s,{size:"small",type:"danger",onClick:d=>J("bad",t.$index),style:{"margin-left":"auto"}},{default:a(()=>e[26]||(e[26]=[i(" 删除 ")])),_:2,__:[26]},1032,["onClick"])]),o("div",Fe,[n(s,{size:"small",type:"primary",onClick:d=>x("bad",t.$index,-1)},{default:a(()=>e[27]||(e[27]=[i("-1")])),_:2,__:[27]},1032,["onClick"]),n(s,{size:"small",type:"primary",onClick:d=>x("bad",t.$index,-10)},{default:a(()=>e[28]||(e[28]=[i("-10")])),_:2,__:[28]},1032,["onClick"])])])):P("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),n(ae,{title:m.value.type==="bad"?"添加坏货":"添加好货",modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=t=>k.value=t),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0},{footer:a(()=>[n(s,{onClick:e[5]||(e[5]=t=>k.value=!1)},{default:a(()=>e[32]||(e[32]=[i("取消")])),_:1,__:[32]}),n(s,{type:"primary",onClick:ee},{default:a(()=>e[33]||(e[33]=[i("确定")])),_:1,__:[33]})]),default:a(()=>[o("div",Ke,[n(ne,{"label-position":"top","label-width":"80px"},{default:a(()=>[n(H,{label:"货物ID"},{default:a(()=>[n(D,{modelValue:m.value.id,"onUpdate:modelValue":e[2]||(e[2]=t=>m.value.id=t)},null,8,["modelValue"]),n(s,{type:"primary",plain:"",size:"small",style:{"margin-top":"5px"},onClick:e[3]||(e[3]=t=>N.value=!0)},{default:a(()=>e[31]||(e[31]=[i("扫码输入")])),_:1,__:[31]})]),_:1}),n(H,{label:"数量"},{default:a(()=>[n(oe,{modelValue:m.value.count,"onUpdate:modelValue":e[4]||(e[4]=t=>m.value.count=t),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["title","modelValue"])])}}};export{Pe as default};
