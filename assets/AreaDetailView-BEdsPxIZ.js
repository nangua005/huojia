import{_ as ye,u as ge,r as _,c as Y,a as _e,w as xe,o as we,b as ce,d as S,e as n,f as a,g as i,h as f,t as r,i as G,j as ke,k as be,l as x,m as s,n as W,F as ee,p as te,q as le,s as oe,v as R,x as Ce}from"./index-DlevVMKT.js";const $e={style:{padding:"20px"}},Ve={style:{"margin-bottom":"20px"}},ze={style:{"margin-bottom":"10px"}},Ne={style:{"text-align":"right","margin-bottom":"20px"}},Se={style:{display:"flex","justify-content":"space-between"}},Ie={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Oe={style:{flex:"1 1 20%","text-align":"right"}},Be={style:{display:"flex","justify-content":"space-between"}},De={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Ue={style:{flex:"1 1 20%","text-align":"right"}},Re={key:0,style:{"margin-top":"5px"}},Te={style:{"margin-top":"5px"}},he={style:{display:"flex","align-items":"center",gap:"5px"}},je={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Me={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Je={style:{display:"flex","justify-content":"space-between"}},Ee={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Ke={style:{flex:"1 1 20%","text-align":"right"}},Ae={style:{display:"flex","justify-content":"space-between"}},Fe={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Pe={style:{flex:"1 1 20%","text-align":"right"}},Le={key:0,style:{"margin-top":"5px"}},Xe={style:{"margin-top":"5px"}},Ze={style:{display:"flex","align-items":"center",gap:"5px"}},qe={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},He={style:{padding:"10px",maxHeight:"60vh",overflowY:"auto"}},Qe={style:{"margin-top":"10px","word-break":"break-all"}},Ye={__name:"AreaDetailView",setup(Ge){const T=ge(),h=be(),O=T.params.shelfNo,v=T.params.area,m=_(null),C=_(!1),w=_(!1),u=_({id:"",count:1,type:"good"}),B=Y(()=>(m.value?.areas[v]||[]).filter(t=>t.type==="good")),j=Y(()=>(m.value?.areas[v]||[]).filter(t=>t.type==="bad")),y=_({}),c=_e({}),ne=t=>({left:"左侧",center:"中间",right:"右侧"})[t]||t,ae=()=>h.push(`/shelf/${O}`),ie=async()=>{const t=await ke(O);if(t){m.value=t;for(const e of t.areas[v])e._expanded=!1}},M=t=>t._expanded=!t._expanded,J=t=>{u.value={id:"",count:1,type:t},C.value=!0},se=async()=>{const t={id:u.value.id,count:u.value.count,name:"",type:u.value.type,_expanded:!1};m.value.areas[v]||(m.value.areas[v]=[]),m.value.areas[v].push(t),y.value[t.id]||(y.value[t.id]=[]),await R(JSON.parse(JSON.stringify(m.value))),re(),C.value=!1},E=async t=>{m.value.areas[v].splice(t,1),await R(JSON.parse(JSON.stringify(m.value)))},g=(t,e,o)=>{const p=t==="good"?B.value:j.value;e<0||e>=p.length||(p[e].count+=o,p[e].count<1&&(p[e].count=1),R(JSON.parse(JSON.stringify(m.value))))},de=(t,e)=>{const o=B.value;if(e<0||e>=o.length)return;const p=o[e].id;h.push(`/product?id=${encodeURIComponent(p)}`)},I=t=>y.value[t]||[],K=t=>{const e=(c[t]||"").trim();e&&(y.value[t]||(y.value[t]=[]),y.value[t].includes(e)||y.value[t].push(e),c[t]="")},A=(t,e)=>{y.value[t]?.splice(e,1)},re=()=>{u.value={id:"",count:1,type:"good"}},k=_(null),b=_("等待扫码...");let $=null,V=null,D="",F=0;xe(w,t=>{t?ue():z()});const P=()=>{F=0,b.value="等待扫码..."},z=async()=>{w.value=!1,P();try{V&&V.getTracks().forEach(t=>t.stop())}catch(t){console.warn("扫码停止失败：",t),alert("扫码停止失败："+t)}V=null;try{k.value&&(k.value.pause(),k.value.srcObject=null)}catch(t){console.warn("视频元素清理失败："+t),alert("视频元素清理失败：")}};function L(t){let e=new Set;for(;t&&t!==Object.prototype;)Object.getOwnPropertyNames(t).filter(o=>typeof t[o]=="function").forEach(o=>e.add(o)),t=Object.getPrototypeOf(t);return[...e]}const ue=async()=>{P(),await Ce(),b.value="等待扫码...",await ZXingBrowser.BrowserQRCodeReader.wasmBindingsReady;const e=(await navigator.mediaDevices.enumerateDevices()).find(o=>o.kind==="videoinput");if(!e){b.value="❌ 没有找到摄像头";return}try{V=await navigator.mediaDevices.getUserMedia({video:{deviceId:e.deviceId,facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}}),k.value.srcObject=V,await new Promise(o=>setTimeout(o,500)),$||($=new ZXingBrowser.BrowserMultiFormatReader,alert("reader的方法"+L($).join(`
`)),console.log("reader的方法"+L($).join(`
`))),F=Date.now(),$.decodeOnceFromVideoElement(k.value,(o,p)=>{pe(o,p)})}catch(o){b.value="❌ 摄像头启动失败："+o}},pe=(t,e)=>{if(w.value!=!1&&t){const o=t.getText();o!==D&&(alert("扫码"+o+"|"+D+"|"),D=o,b.value="✅ 扫码成功："+o,u.value.id=o,z())}};return we(ie),ce(async()=>{await z()}),(t,e)=>{const o=f("el-button"),p=f("el-tag"),U=f("el-input"),X=f("el-table-column"),Z=f("el-table"),q=f("el-card"),H=f("el-form-item"),me=f("el-input-number"),fe=f("el-form"),Q=f("el-dialog");return x(),S("div",$e,[n("div",Ve,[a(o,{type:"primary",onClick:ae},{default:i(()=>e[8]||(e[8]=[s("返回货架详情")])),_:1,__:[8]})]),n("h2",ze,r(G(O))+" - "+r(ne(G(v)))+" 区域",1),n("div",Ne,[a(o,{type:"success",onClick:e[0]||(e[0]=l=>J("good"))},{default:i(()=>e[9]||(e[9]=[s("添加好货")])),_:1,__:[9]}),a(o,{type:"warning",onClick:e[1]||(e[1]=l=>J("bad"))},{default:i(()=>e[10]||(e[10]=[s("添加坏货")])),_:1,__:[10]})]),e[36]||(e[36]=n("h3",null,"好货列表",-1)),a(q,{style:{"margin-bottom":"10px",padding:"0px"}},{default:i(()=>[a(Z,{data:B.value,style:{width:"100%"},size:"small",border:""},{default:i(()=>[a(X,{label:"货物信息"},{default:i(l=>[n("div",Se,[n("div",Ie,[e[11]||(e[11]=n("strong",null,"编号:",-1)),s(" "+r(l.row.id),1)]),n("div",Oe,[e[12]||(e[12]=n("strong",null,"数量:",-1)),s(" "+r(l.row.count),1)])]),n("div",Be,[n("div",De,[e[13]||(e[13]=n("strong",null,"名称:",-1)),s(" "+r(I(l.row.id)[0]||"无"),1)]),n("div",Ue,[a(o,{size:"small",text:"",onClick:d=>M(l.row)},{default:i(()=>[s(r(l.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),l.row._expanded?(x(),S("div",Re,[e[20]||(e[20]=n("div",null,[n("strong",null,"标签:")],-1)),n("div",Te,[(x(!0),S(ee,null,te(I(l.row.id),(d,N)=>(x(),le(p,{key:N,closable:"",onClose:ve=>A(l.row.id,N),style:{margin:"2px"}},{default:i(()=>[s(r(d),1)]),_:2},1032,["onClose"]))),128)),a(U,{modelValue:c[l.row.id],"onUpdate:modelValue":d=>c[l.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:oe(d=>K(l.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[21]||(e[21]=n("div",{style:{"margin-top":"5px"}},[n("strong",null,"操作:")],-1)),n("div",he,[a(o,{size:"small",type:"primary",onClick:d=>g("good",l.$index,1)},{default:i(()=>e[14]||(e[14]=[s("+1")])),_:2,__:[14]},1032,["onClick"]),a(o,{size:"small",type:"primary",onClick:d=>g("good",l.$index,10)},{default:i(()=>e[15]||(e[15]=[s("+10")])),_:2,__:[15]},1032,["onClick"]),a(o,{size:"small",type:"danger",onClick:d=>E("good",l.$index),style:{"margin-left":"auto"}},{default:i(()=>e[16]||(e[16]=[s(" 删除 ")])),_:2,__:[16]},1032,["onClick"])]),n("div",je,[a(o,{size:"small",type:"primary",onClick:d=>g("good",l.$index,-1)},{default:i(()=>e[17]||(e[17]=[s("-1")])),_:2,__:[17]},1032,["onClick"]),a(o,{size:"small",type:"primary",onClick:d=>g("good",l.$index,-10)},{default:i(()=>e[18]||(e[18]=[s("-10")])),_:2,__:[18]},1032,["onClick"])]),n("div",Me,[a(o,{size:"small",type:"primary",onClick:d=>de("good",l.$index)},{default:i(()=>e[19]||(e[19]=[s("查询所有位置")])),_:2,__:[19]},1032,["onClick"])])])):W("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),e[37]||(e[37]=n("h3",null,"坏货列表",-1)),a(q,{style:{"margin-bottom":"10px",padding:"0px"}},{default:i(()=>[a(Z,{data:j.value,style:{width:"100%"},size:"small",border:""},{default:i(()=>[a(X,{label:"货物信息"},{default:i(l=>[n("div",Je,[n("div",Ee,[e[22]||(e[22]=n("strong",null,"编号:",-1)),s(" "+r(l.row.id),1)]),n("div",Ke,[e[23]||(e[23]=n("strong",null,"数量:",-1)),s(" "+r(l.row.count),1)])]),n("div",Ae,[n("div",Fe,[e[24]||(e[24]=n("strong",null,"名称:",-1)),s(" "+r(I(l.row.id)[0]||"无"),1)]),n("div",Pe,[a(o,{size:"small",text:"",onClick:d=>M(l.row)},{default:i(()=>[s(r(l.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),l.row._expanded?(x(),S("div",Le,[e[30]||(e[30]=n("div",null,[n("strong",null,"标签:")],-1)),n("div",Xe,[(x(!0),S(ee,null,te(I(l.row.id),(d,N)=>(x(),le(p,{key:N,closable:"",onClose:ve=>A(l.row.id,N),style:{margin:"2px"}},{default:i(()=>[s(r(d),1)]),_:2},1032,["onClose"]))),128)),a(U,{modelValue:c[l.row.id],"onUpdate:modelValue":d=>c[l.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:oe(d=>K(l.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[31]||(e[31]=n("div",{style:{"margin-top":"5px"}},[n("strong",null,"操作:")],-1)),n("div",Ze,[a(o,{size:"small",type:"primary",onClick:d=>g("bad",l.$index,1)},{default:i(()=>e[25]||(e[25]=[s("+1")])),_:2,__:[25]},1032,["onClick"]),a(o,{size:"small",type:"primary",onClick:d=>g("bad",l.$index,10)},{default:i(()=>e[26]||(e[26]=[s("+10")])),_:2,__:[26]},1032,["onClick"]),a(o,{size:"small",type:"danger",onClick:d=>E("bad",l.$index),style:{"margin-left":"auto"}},{default:i(()=>e[27]||(e[27]=[s(" 删除 ")])),_:2,__:[27]},1032,["onClick"])]),n("div",qe,[a(o,{size:"small",type:"primary",onClick:d=>g("bad",l.$index,-1)},{default:i(()=>e[28]||(e[28]=[s("-1")])),_:2,__:[28]},1032,["onClick"]),a(o,{size:"small",type:"primary",onClick:d=>g("bad",l.$index,-10)},{default:i(()=>e[29]||(e[29]=[s("-10")])),_:2,__:[29]},1032,["onClick"])])])):W("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),a(Q,{title:u.value.type==="bad"?"添加坏货":"添加好货",modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=l=>C.value=l),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0},{footer:i(()=>[a(o,{onClick:e[5]||(e[5]=l=>C.value=!1)},{default:i(()=>e[33]||(e[33]=[s("取消")])),_:1,__:[33]}),a(o,{type:"primary",onClick:se},{default:i(()=>e[34]||(e[34]=[s("确定")])),_:1,__:[34]})]),default:i(()=>[n("div",He,[a(fe,{"label-position":"top","label-width":"80px"},{default:i(()=>[a(H,{label:"货物ID"},{default:i(()=>[a(U,{modelValue:u.value.id,"onUpdate:modelValue":e[2]||(e[2]=l=>u.value.id=l)},null,8,["modelValue"]),a(o,{type:"primary",plain:"",size:"small",style:{"margin-top":"5px"},onClick:e[3]||(e[3]=l=>w.value=!0)},{default:i(()=>e[32]||(e[32]=[s("扫码输入")])),_:1,__:[32]})]),_:1}),a(H,{label:"数量"},{default:i(()=>[a(me,{modelValue:u.value.count,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.count=l),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["title","modelValue"]),a(Q,{title:"扫码输入",modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=l=>w.value=l),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0,onClose:z},{footer:i(()=>[a(o,{onClick:z},{default:i(()=>e[35]||(e[35]=[s("取消")])),_:1,__:[35]})]),default:i(()=>[n("video",{ref_key:"videoRef",ref:k,autoplay:"",muted:"",playsinline:"",style:{width:"100%","max-height":"260px",border:"1px solid #ccc"}},null,512),n("div",Qe,r(b.value),1)]),_:1},8,["modelValue"])])}}},et=ye(Ye,[["__scopeId","data-v-a37c6f88"]]);export{et as default};
