import{_ as fe,u as ye,r as c,c as Y,a as ge,w as _e,o as xe,b as we,d as N,e as o,f as n,g as a,h as v,t as r,i as G,j as ce,k as ke,l as k,m as s,n as W,F as ee,p as te,q as le,s as oe,v as T,x as be}from"./index-BStP0xeb.js";import"./html5-qrcode-scanner-6-dcQOjr.js";const Ce={style:{padding:"20px"}},$e={style:{"margin-bottom":"20px"}},Ve={style:{"margin-bottom":"10px"}},ze={style:{"text-align":"right","margin-bottom":"20px"}},Se={style:{display:"flex","justify-content":"space-between"}},Ie={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Ne={style:{flex:"1 1 20%","text-align":"right"}},Be={style:{display:"flex","justify-content":"space-between"}},De={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Oe={style:{flex:"1 1 20%","text-align":"right"}},Ue={key:0,style:{"margin-top":"5px"}},je={style:{"margin-top":"5px"}},Re={style:{display:"flex","align-items":"center",gap:"5px"}},Te={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Je={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},Me={style:{display:"flex","justify-content":"space-between"}},Ke={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},he={style:{flex:"1 1 20%","text-align":"right"}},Ee={style:{display:"flex","justify-content":"space-between"}},Fe={style:{flex:"1 1 80%",overflow:"hidden","text-overflow":"ellipsis"}},Ae={style:{flex:"1 1 20%","text-align":"right"}},Pe={key:0,style:{"margin-top":"5px"}},Le={style:{"margin-top":"5px"}},Xe={style:{display:"flex","align-items":"center",gap:"5px"}},Ze={style:{"margin-top":"5px",display:"flex","align-items":"center",gap:"5px"}},qe={style:{padding:"10px",maxHeight:"60vh",overflowY:"auto"}},He={style:{"margin-top":"10px","word-break":"break-all"}},Qe={__name:"AreaDetailView",setup(Ye){const J=ye(),M=ke(),U=J.params.shelfNo,y=J.params.area,p=c(null),$=c(!1),V=c(!1),u=c({id:"",count:1,type:"good"}),j=Y(()=>(p.value?.areas[y]||[]).filter(t=>t.type==="good")),K=Y(()=>(p.value?.areas[y]||[]).filter(t=>t.type==="bad")),g=c({}),b=ge({}),ne=t=>({left:"左侧",center:"中间",right:"右侧"})[t]||t,ae=()=>M.push(`/shelf/${U}`),ie=async()=>{const t=await ce(U);if(t){p.value=t;for(const e of t.areas[y])e._expanded=!1}},h=t=>t._expanded=!t._expanded,E=t=>{u.value={id:"",count:1,type:t},$.value=!0},se=async()=>{const t={id:u.value.id,count:u.value.count,name:"",type:u.value.type,_expanded:!1};p.value.areas[y]||(p.value.areas[y]=[]),p.value.areas[y].push(t),g.value[t.id]||(g.value[t.id]=[]),await T(JSON.parse(JSON.stringify(p.value))),re(),$.value=!1},F=async t=>{p.value.areas[y].splice(t,1),await T(JSON.parse(JSON.stringify(p.value)))},_=(t,e,i)=>{const m=t==="good"?j.value:K.value;e<0||e>=m.length||(m[e].count+=i,m[e].count<1&&(m[e].count=1),T(JSON.parse(JSON.stringify(p.value))))},de=(t,e)=>{const i=j.value;if(e<0||e>=i.length)return;const m=i[e].id;M.push(`/product?id=${encodeURIComponent(m)}`)},B=t=>g.value[t]||[],A=t=>{const e=(b[t]||"").trim();e&&(g.value[t]||(g.value[t]=[]),g.value[t].includes(e)||g.value[t].push(e),b[t]="")},P=(t,e)=>{g.value[t]?.splice(e,1)},re=()=>{u.value={id:"",count:1,type:"good"}},x=c(null),C=c("等待扫码...");let D=null,z=null,w=null,O="",L=0;_e(V,t=>{t?ue():S()});const X=()=>{L=0,C.value="等待扫码...",O=""},S=async()=>{V.value=!1,X(),w&&w(),w=null;try{z&&z.getTracks().forEach(t=>t.stop())}catch(t){console.warn("扫码停止失败：",t),alert("扫码停止失败："+t)}z=null;try{x.value&&(x.value.pause(),x.value.srcObject=null)}catch(t){console.warn("视频元素清理失败："+t),alert("视频元素清理失败：")}},ue=async()=>{X(),await be(),C.value="等待扫码...",w&&w(),w=null,await ZXingBrowser.BrowserQRCodeReader.wasmBindingsReady;const e=(await navigator.mediaDevices.enumerateDevices()).find(i=>i.kind==="videoinput");if(!e){C.value="❌ 没有找到摄像头";return}try{z=await navigator.mediaDevices.getUserMedia({video:{deviceId:e.deviceId,facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}}),x.value.srcObject=z,x.value.play(),await new Promise(i=>setTimeout(i,500)),D||(D=new ZXingBrowser.BrowserMultiFormatReader,alert("reader的方法"+Object.getOwnPropertyNames(Object.getPrototypeOf(D)).join(","))),L=Date.now(),w=D.decodeFromVideoElement(x.value,(i,m)=>{if(i){const f=i.getText(),R=Date.now();f!==O&&(alert("扫码"+f+"|"+O+"|"),O=f,C.value="✅ 扫码成功："+f,u.value.id=f,S())}})}catch(i){C.value="❌ 摄像头启动失败："+i}};return xe(ie),we(async()=>{await S()}),(t,e)=>{const i=v("el-button"),m=v("el-tag"),f=v("el-input"),R=v("el-table-column"),Z=v("el-table"),q=v("el-card"),H=v("el-form-item"),pe=v("el-input-number"),me=v("el-form"),Q=v("el-dialog");return k(),N("div",Ce,[o("div",$e,[n(i,{type:"primary",onClick:ae},{default:a(()=>e[8]||(e[8]=[s("返回货架详情")])),_:1,__:[8]})]),o("h2",Ve,r(G(U))+" - "+r(ne(G(y)))+" 区域",1),o("div",ze,[n(i,{type:"success",onClick:e[0]||(e[0]=l=>E("good"))},{default:a(()=>e[9]||(e[9]=[s("添加好货")])),_:1,__:[9]}),n(i,{type:"warning",onClick:e[1]||(e[1]=l=>E("bad"))},{default:a(()=>e[10]||(e[10]=[s("添加坏货")])),_:1,__:[10]})]),e[36]||(e[36]=o("h3",null,"好货列表",-1)),n(q,{style:{"margin-bottom":"10px",padding:"0px"}},{default:a(()=>[n(Z,{data:j.value,style:{width:"100%"},size:"small",border:""},{default:a(()=>[n(R,{label:"货物信息"},{default:a(l=>[o("div",Se,[o("div",Ie,[e[11]||(e[11]=o("strong",null,"编号:",-1)),s(" "+r(l.row.id),1)]),o("div",Ne,[e[12]||(e[12]=o("strong",null,"数量:",-1)),s(" "+r(l.row.count),1)])]),o("div",Be,[o("div",De,[e[13]||(e[13]=o("strong",null,"名称:",-1)),s(" "+r(B(l.row.id)[0]||"无"),1)]),o("div",Oe,[n(i,{size:"small",text:"",onClick:d=>h(l.row)},{default:a(()=>[s(r(l.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),l.row._expanded?(k(),N("div",Ue,[e[20]||(e[20]=o("div",null,[o("strong",null,"标签:")],-1)),o("div",je,[(k(!0),N(ee,null,te(B(l.row.id),(d,I)=>(k(),le(m,{key:I,closable:"",onClose:ve=>P(l.row.id,I),style:{margin:"2px"}},{default:a(()=>[s(r(d),1)]),_:2},1032,["onClose"]))),128)),n(f,{modelValue:b[l.row.id],"onUpdate:modelValue":d=>b[l.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:oe(d=>A(l.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[21]||(e[21]=o("div",{style:{"margin-top":"5px"}},[o("strong",null,"操作:")],-1)),o("div",Re,[n(i,{size:"small",type:"primary",onClick:d=>_("good",l.$index,1)},{default:a(()=>e[14]||(e[14]=[s("+1")])),_:2,__:[14]},1032,["onClick"]),n(i,{size:"small",type:"primary",onClick:d=>_("good",l.$index,10)},{default:a(()=>e[15]||(e[15]=[s("+10")])),_:2,__:[15]},1032,["onClick"]),n(i,{size:"small",type:"danger",onClick:d=>F("good",l.$index),style:{"margin-left":"auto"}},{default:a(()=>e[16]||(e[16]=[s(" 删除 ")])),_:2,__:[16]},1032,["onClick"])]),o("div",Te,[n(i,{size:"small",type:"primary",onClick:d=>_("good",l.$index,-1)},{default:a(()=>e[17]||(e[17]=[s("-1")])),_:2,__:[17]},1032,["onClick"]),n(i,{size:"small",type:"primary",onClick:d=>_("good",l.$index,-10)},{default:a(()=>e[18]||(e[18]=[s("-10")])),_:2,__:[18]},1032,["onClick"])]),o("div",Je,[n(i,{size:"small",type:"primary",onClick:d=>de("good",l.$index)},{default:a(()=>e[19]||(e[19]=[s("查询所有位置")])),_:2,__:[19]},1032,["onClick"])])])):W("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),e[37]||(e[37]=o("h3",null,"坏货列表",-1)),n(q,{style:{"margin-bottom":"10px",padding:"0px"}},{default:a(()=>[n(Z,{data:K.value,style:{width:"100%"},size:"small",border:""},{default:a(()=>[n(R,{label:"货物信息"},{default:a(l=>[o("div",Me,[o("div",Ke,[e[22]||(e[22]=o("strong",null,"编号:",-1)),s(" "+r(l.row.id),1)]),o("div",he,[e[23]||(e[23]=o("strong",null,"数量:",-1)),s(" "+r(l.row.count),1)])]),o("div",Ee,[o("div",Fe,[e[24]||(e[24]=o("strong",null,"名称:",-1)),s(" "+r(B(l.row.id)[0]||"无"),1)]),o("div",Ae,[n(i,{size:"small",text:"",onClick:d=>h(l.row)},{default:a(()=>[s(r(l.row._expanded?"收起":"展开"),1)]),_:2},1032,["onClick"])])]),l.row._expanded?(k(),N("div",Pe,[e[30]||(e[30]=o("div",null,[o("strong",null,"标签:")],-1)),o("div",Le,[(k(!0),N(ee,null,te(B(l.row.id),(d,I)=>(k(),le(m,{key:I,closable:"",onClose:ve=>P(l.row.id,I),style:{margin:"2px"}},{default:a(()=>[s(r(d),1)]),_:2},1032,["onClose"]))),128)),n(f,{modelValue:b[l.row.id],"onUpdate:modelValue":d=>b[l.row.id]=d,placeholder:"添加标签",size:"small",onKeyup:oe(d=>A(l.row.id),["enter"]),style:{width:"120px","margin-left":"5px"}},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),e[31]||(e[31]=o("div",{style:{"margin-top":"5px"}},[o("strong",null,"操作:")],-1)),o("div",Xe,[n(i,{size:"small",type:"primary",onClick:d=>_("bad",l.$index,1)},{default:a(()=>e[25]||(e[25]=[s("+1")])),_:2,__:[25]},1032,["onClick"]),n(i,{size:"small",type:"primary",onClick:d=>_("bad",l.$index,10)},{default:a(()=>e[26]||(e[26]=[s("+10")])),_:2,__:[26]},1032,["onClick"]),n(i,{size:"small",type:"danger",onClick:d=>F("bad",l.$index),style:{"margin-left":"auto"}},{default:a(()=>e[27]||(e[27]=[s(" 删除 ")])),_:2,__:[27]},1032,["onClick"])]),o("div",Ze,[n(i,{size:"small",type:"primary",onClick:d=>_("bad",l.$index,-1)},{default:a(()=>e[28]||(e[28]=[s("-1")])),_:2,__:[28]},1032,["onClick"]),n(i,{size:"small",type:"primary",onClick:d=>_("bad",l.$index,-10)},{default:a(()=>e[29]||(e[29]=[s("-10")])),_:2,__:[29]},1032,["onClick"])])])):W("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),n(Q,{title:u.value.type==="bad"?"添加坏货":"添加好货",modelValue:$.value,"onUpdate:modelValue":e[6]||(e[6]=l=>$.value=l),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0},{footer:a(()=>[n(i,{onClick:e[5]||(e[5]=l=>$.value=!1)},{default:a(()=>e[33]||(e[33]=[s("取消")])),_:1,__:[33]}),n(i,{type:"primary",onClick:se},{default:a(()=>e[34]||(e[34]=[s("确定")])),_:1,__:[34]})]),default:a(()=>[o("div",qe,[n(me,{"label-position":"top","label-width":"80px"},{default:a(()=>[n(H,{label:"货物ID"},{default:a(()=>[n(f,{modelValue:u.value.id,"onUpdate:modelValue":e[2]||(e[2]=l=>u.value.id=l)},null,8,["modelValue"]),n(i,{type:"primary",plain:"",size:"small",style:{"margin-top":"5px"},onClick:e[3]||(e[3]=l=>V.value=!0)},{default:a(()=>e[32]||(e[32]=[s("扫码输入")])),_:1,__:[32]})]),_:1}),n(H,{label:"数量"},{default:a(()=>[n(pe,{modelValue:u.value.count,"onUpdate:modelValue":e[4]||(e[4]=l=>u.value.count=l),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["title","modelValue"]),n(Q,{title:"扫码输入",modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=l=>V.value=l),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0,onClose:S},{footer:a(()=>[n(i,{onClick:S},{default:a(()=>e[35]||(e[35]=[s("取消")])),_:1,__:[35]})]),default:a(()=>[o("video",{ref_key:"videoRef",ref:x,autoplay:"",muted:"",playsinline:"",style:{width:"100%","max-height":"260px",border:"1px solid #ccc"}},null,512),o("div",He,r(C.value),1)]),_:1},8,["modelValue"])])}}},et=fe(Qe,[["__scopeId","data-v-7b16a98e"]]);export{et as default};
