import{r as h,u as P,o as U,y as q,c as b,w as H,b as M,d as C,f as a,e as E,n as S,g as i,h as u,z as R,t as y,k as F,l as x,m as k,x as Q}from"./index-BM-2b94o.js";import{H as $,a as o}from"./html5-qrcode-scanner-BvUljK1N.js";const j={style:{padding:"20px"}},z={key:0,style:{"margin-top":"10px","font-weight":"bold"}},G={key:1,style:{"margin-top":"10px","font-weight":"bold"}},X={__name:"ProductSearchView",setup(K){const B=P(),I=F(),s=h(B.query.id||""),p=h([]),m=h(!1);let r=null;const N=()=>{I.back()},T={left:"左",center:"中",right:"右"};U(()=>{s.value&&D()});const D=async()=>{const t=s.value.trim();if(!t)return;const e=await q(),d=[];for(const _ of e)for(const[v,w]of Object.entries(_.areas)){const g=w.filter(l=>l.id===t&&l.type==="good").reduce((l,n)=>l+(n.count||0),0),c=w.filter(l=>l.id===t&&l.type==="bad").reduce((l,n)=>l+(n.count||0),0);(g>0||c>0)&&d.push({position:`${_.shelfNo}-${T[v]||v}`,goodCount:g,badCount:c})}p.value=d},V=b(()=>p.value.reduce((t,e)=>t+e.goodCount,0)),A=b(()=>p.value.reduce((t,e)=>t+e.badCount,0)),O=b(()=>V.value+A.value);H(m,async t=>{if(t){await Q(),r||(r=new $("html5qr-code"));try{await r.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:150},formatsToSupport:[o.EAN_13,o.CODE_128,o.EAN_8,o.UPC_A,o.UPC_E,o.CODE_39,o.CODE_93,o.ITF,o.DATA_MATRIX,o.AZTEC,o.QR_CODE,o.PDF_417]},e=>{s.value=e,m.value=!1,f(),searchProduct()},()=>{})}catch(e){alert("扫码失败："+e),f()}}else f()});const f=async()=>{if(r)try{await r.stop(),await r.clear(),r=null}catch(t){console.warn("扫码停止失败：",t)}};return M(async()=>{await f()}),(t,e)=>{const d=u("el-button"),_=u("el-input"),v=u("el-form-item"),w=u("el-form"),g=u("el-dialog"),c=u("el-table-column"),l=u("el-table");return x(),C("div",j,[a(d,{type:"primary",onClick:N,style:{"margin-bottom":"20px"}},{default:i(()=>e[4]||(e[4]=[k(" 返回上一页 ")])),_:1,__:[4]}),e[8]||(e[8]=E("h2",null,"产品位置查询",-1)),a(w,{onSubmit:e[2]||(e[2]=R(()=>{},["prevent"]))},{default:i(()=>[a(v,{label:"产品ID"},{default:i(()=>[a(_,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=n=>s.value=n),placeholder:"请输入产品ID",style:{width:"300px","margin-right":"10px"}},null,8,["modelValue"]),a(d,{type:"default",onClick:e[1]||(e[1]=n=>m.value=!0)},{default:i(()=>e[5]||(e[5]=[k("扫码输入")])),_:1,__:[5]}),a(d,{type:"primary",onClick:D},{default:i(()=>e[6]||(e[6]=[k("搜索")])),_:1,__:[6]})]),_:1})]),_:1}),a(g,{title:"扫码产品 ID",modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=n=>m.value=n),width:"90%","close-on-click-modal":!1,"destroy-on-close":!0},{default:i(()=>e[7]||(e[7]=[E("div",{id:"html5qr-code",style:{width:"100%",height:"300px"}},null,-1)])),_:1,__:[7]},8,["modelValue"]),s.value?(x(),C("div",z," 当前查询产品 ID："+y(s.value),1)):S("",!0),a(l,{data:p.value,style:{width:"100%","margin-top":"20px"},border:"","header-cell-style":{whiteSpace:"nowrap",fontWeight:"bold"},"cell-style":{whiteSpace:"normal",wordBreak:"break-word",lineHeight:"1.4"}},{default:i(()=>[a(c,{prop:"position",label:"位置","min-width":"50%","show-overflow-tooltip":!1}),a(c,{prop:"goodCount",label:"好货",width:"80",align:"center"}),a(c,{prop:"badCount",label:"坏货",width:"80",align:"center"})]),_:1},8,["data"]),p.value.length?(x(),C("div",G," 总计： 好货 "+y(V.value)+" 件， 坏货 "+y(A.value)+" 件， 合计 "+y(O.value)+" 件 ",1)):S("",!0)])}}};export{X as default};
